<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ãƒ­ãƒˆ6 AIäºˆæƒ³ãƒ©ãƒœ</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 16px;
      background: #f4f4f4;
    }
    h1 {
      font-size: 1.4rem;
      margin-bottom: 12px;
      text-align: center;
    }
    .tabs {
      display: flex;
      margin-bottom: 12px;
      border-radius: 999px;
      background: #e0e0e0;
      padding: 4px;
    }
    .tab {
      flex: 1;
      text-align: center;
      padding: 8px 0;
      border-radius: 999px;
      font-size: 0.9rem;
      cursor: pointer;
      user-select: none;
    }
    .tab.active {
      background: #ffffff;
      box-shadow: 0 1px 3px rgba(0,0,0,0.2);
      font-weight: 600;
    }
    .card {
      background: #ffffff;
      border-radius: 12px;
      padding: 12px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 12px;
    }
    .field {
      margin-bottom: 10px;
      font-size: 0.9rem;
    }
    label {
      display: block;
      margin-bottom: 4px;
    }
    input[type="number"] {
      width: 100%;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 0.9rem;
      box-sizing: border-box;
    }
    input[type="checkbox"] {
      margin-right: 4px;
    }
    button {
      width: 100%;
      padding: 10px;
      border-radius: 999px;
      border: none;
      font-size: 0.95rem;
      font-weight: 600;
      margin-top: 4px;
      cursor: pointer;
      background: #007aff;
      color: #ffffff;
    }
    button.secondary {
      background: #555555;
      margin-top: 8px;
    }
    textarea {
      width: 100%;
      min-height: 140px;
      padding: 8px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 0.9rem;
      box-sizing: border-box;
      resize: vertical;
    }
    .note {
      font-size: 0.75rem;
      color: #666;
      line-height: 1.5;
    }
    .hidden {
      display: none;
    }
    .summary-box {
      font-size: 0.8rem;
      background: #f7f7f7;
      border-radius: 8px;
      padding: 8px;
      border: 1px solid #ddd;
      white-space: pre-wrap;
    }
    /* ãƒ›ãƒ¼ãƒ ãƒ¡ãƒ‹ãƒ¥ãƒ¼é¢¨ */
    .menu-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
    }
    .menu-item {
      border-radius: 12px;
      padding: 10px;
      background: linear-gradient(135deg, #fff, #f4f7ff);
      border: 1px solid #e0e4ff;
      font-size: 0.8rem;
      cursor: pointer;
    }
    .menu-title {
      font-weight: 600;
      margin-bottom: 4px;
      font-size: 0.9rem;
    }
    .menu-desc {
      color: #666;
      font-size: 0.75rem;
      line-height: 1.4;
    }
    /* ãƒãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼é¢¨ãƒ†ãƒ¼ãƒ–ãƒ« */
    .history-table-wrap {
      margin-top: 10px;
      max-height: 260px;
      overflow-y: auto;
      border-radius: 8px;
      border: 1px solid #ddd;
      background: #fff;
    }
    table.history-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8rem;
    }
    table.history-table th,
    table.history-table td {
      padding: 4px 6px;
      border-bottom: 1px solid #eee;
      text-align: left;
      vertical-align: middle;
      white-space: nowrap;
    }
    table.history-table th {
      background: #fafafa;
      position: sticky;
      top: 0;
      z-index: 1;
    }
    table.history-table tr:nth-child(even) td {
      background: #fcfcfc;
    }
    .ball {
      display: inline-block;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      border: 1px solid #ddd;
      text-align: center;
      line-height: 24px;
      margin-right: 3px;
      margin-bottom: 2px;
      font-size: 0.75rem;
      background: #fdfdfd;
    }
    .ball-bonus {
      background: #e6f7ff;
      border-color: #7fb8f2;
    }
    .slot-row {
      display: flex;
      gap: 4px;
      margin-top: 4px;
    }
    .slot-cell {
      width: 28px;
      height: 28px;
      border-radius: 6px;
      background: #111827;
      color: #f9fafb;
      font-family: "SF Mono", Menlo, Consolas, monospace;
      font-size: 0.8rem;
      text-align: center;
      line-height: 28px;
    }
    .slot-cell.slot-bonus {
      background: #e6f7ff;
      border: 1px solid #7fb8f2;
      color: #0f172a;
    }

    /* === AIäºˆæƒ³ç”¨ã®ç‰ãƒ‡ã‚¶ã‚¤ãƒ³ï¼†ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ === */
    .ball {
      transition: transform 0.15s ease-out, box-shadow 0.15s ease-out;
    }

    .ball-pop {
      animation: ball-pop 0.35s ease-out;
    }

    @keyframes ball-pop {
      0% {
        transform: scale(0.1);
        opacity: 0;
      }
      70% {
        transform: scale(1.15);
        opacity: 1;
      }
      100% {
        transform: scale(1);
        opacity: 1;
      }
    }

    /* AIäºˆæƒ³ãƒ¢ãƒ¼ãƒ‰ã§ä½¿ã†ç‰ï¼ˆé€šå¸¸æ•°å­—ï¼‰ */
    .ball-ai {
      background: linear-gradient(135deg, #eef2ff, #ffffff);
      border-color: #6366f1;
      box-shadow: 0 0 0 1px rgba(99, 102, 241, 0.4);
    }

    /* AIçš„ã«â€œé »å‡ºâ€ã§å¼·ãæ¨ã—ã¦ã„ã‚‹æ•°å­—ï¼ˆãƒˆãƒƒãƒ—10ãªã©ï¼‰ */
    .ball-ai-strong {
      background: linear-gradient(135deg, #fee2e2, #f97316);
      border-color: #f97316;
      color: #111827;
      box-shadow: 0 0 0 1px rgba(248, 113, 113, 0.6);
    }

    /* AIãƒ¢ãƒ¼ãƒ‰æ™‚ã®ãƒœãƒ¼ãƒŠã‚¹ç‰ï¼ˆã¡ã‚‡ã£ã¨ç‰¹åˆ¥æ„Ÿï¼‰ */
    .ball-ai-bonus {
      background: linear-gradient(135deg, #e0f2fe, #f9fafb);
      border-color: #0ea5e9;
      color: #0f172a;
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.6);
    }
  </style>

  <!-- æ£’ã‚°ãƒ©ãƒ•ç”¨ Chart.js èª­ã¿è¾¼ã¿ -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h1>ãƒ­ãƒˆ6 AIäºˆæƒ³ãƒ©ãƒœ</h1>

  <div class="tabs">
    <div class="tab active" id="tab-home" onclick="showTab('home')">ãƒ›ãƒ¼ãƒ </div>
    <div class="tab" id="tab-loto" onclick="showTab('loto')">ãƒ­ãƒˆ6äºˆæƒ³</div>
    <div class="tab" id="tab-analysis" onclick="showTab('analysis')">éå»ãƒ‡ãƒ¼ã‚¿è§£æ</div>
  </div>

  <!-- ãƒ›ãƒ¼ãƒ  -->
  <div id="panel-home" class="card">
    <div class="field">
      <div class="note" style="margin-bottom:8px;">
        ãƒ­ãƒˆ6ã®éå»ãƒ‡ãƒ¼ã‚¿ã‚’å…ƒã«ã€å‡ºã‚„ã™ã„æ•°å­—ãªã©ã‚’â€œAIé¢¨â€ã«è§£æã—ã¦äºˆæƒ³ã‚’ä½œã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚<br>
        â€»å½“é¸ã‚’ä¿è¨¼ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚éŠã³ã¨ã—ã¦ãŠä½¿ã„ãã ã•ã„ã€‚
      </div>
      <div class="menu-grid">
        <div class="menu-item" onclick="showTab('loto')">
          <div class="menu-title">AIãŠã¾ã‹ã›äºˆæƒ³</div>
          <div class="menu-desc">
            ã“ã‚Œã¾ã§è²¯ã‚ãŸãƒãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼ã®å‚¾å‘ã‚’ä½¿ã£ã¦ã€å‡ºã‚„ã™ã„æ•°å­—ã‚’å°‘ã—ã ã‘é‡ãã—ãŸ
            â€œAIäºˆæƒ³ãƒ¢ãƒ¼ãƒ‰â€ã§ãƒ­ãƒˆ6ã®çµ„ã¿åˆã‚ã›ã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã™ï¼ˆæœ¬æ•°å­—6å€‹ï¼‹ãƒœãƒ¼ãƒŠã‚¹å€™è£œ1å€‹ï¼‰ã€‚
          </div>
        </div>
        <div class="menu-item" onclick="showTab('analysis')">
          <div class="menu-title">â‘  éå»ãƒ‡ãƒ¼ã‚¿å…¥åŠ›ï¼†è§£æ</div>
          <div class="menu-desc">
            ä¸Šã®å…¥åŠ›æ¬„ã«æ–°ã—ã„å›ã®ãƒ‡ãƒ¼ã‚¿ã‚’è²¼ã‚Šä»˜ã‘ã¦ã€Œè¿½åŠ ã€ã™ã‚‹ã¨ã€<br>
            AIè§£æï¼‹ä¸‹ã®ãƒãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼ä¸€è¦§ã«åæ˜ ã•ã‚Œã¾ã™ã€‚
          </div>
        </div>
        <div class="menu-item" onclick="goToHistoryList()">
          <div class="menu-title">â‘¢ ãƒãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼ä¸€è¦§ã‚’è¦‹ã‚‹</div>
          <div class="menu-desc">
            ã€Œéå»ãƒ‡ãƒ¼ã‚¿è§£æã€ã‚¿ãƒ–ã®ä¸€ç•ªä¸‹ã«ã€ã“ã‚Œã¾ã§è¿½åŠ ã—ãŸå›ãŒ<br>
            å›å·ã¤ããƒãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼é¢¨ãƒ†ãƒ¼ãƒ–ãƒ«ã§è²¯ã¾ã£ã¦ã„ãã¾ã™ã€‚
          </div>
        </div>
        <div class="menu-item" onclick="openRakuten()">
          <div class="menu-title">å…¬å¼ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèª</div>
          <div class="menu-desc">
            Safariã§æ¥½å¤©ã®ã€Œãƒ­ãƒˆ6 éå»å½“ã›ã‚“ç•ªå·ã€ãƒšãƒ¼ã‚¸ã‚’é–‹ãã¾ã™ã€‚
            å¿…è¦ãªå›ã ã‘ã‚³ãƒ”ãƒ¼ã—ã¦ã“ã®ã‚¢ãƒ—ãƒªã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ãƒ­ãƒˆ6äºˆæƒ³ -->
  <div id="panel-loto" class="card hidden">
    <div class="field">
      <div>ãƒ­ãƒˆ6ï¼ˆ1ã€œ43ã‹ã‚‰æœ¬æ•°å­—6å€‹ï¼‹ãƒœãƒ¼ãƒŠã‚¹å€™è£œ1å€‹ï¼‰</div>
      <div class="note">
        â€»å®Ÿéš›ã®è³¼å…¥ã§ã¯æœ¬æ•°å­—6å€‹ã ã‘é¸ã³ã¾ã™ã€‚ã“ã“ã§ã¯ã€ŒãŠã¾ã‘ã®ãƒœãƒ¼ãƒŠã‚¹å€™è£œã€ã‚‚1ã¤å‡ºã—ã¾ã™ã€‚
      </div>
    </div>
    <div class="field">
      <label for="loto-count">çµ„ã¿åˆã‚ã›æ•°ï¼ˆ1ã€œ20ï¼‰</label>
      <input type="number" id="loto-count" min="1" max="20" value="5" />
    </div>
    <div class="field">
      <label>
        <input type="checkbox" id="loto-sort" checked />
        æœ¬æ•°å­—ã‚’å°ã•ã„é †ã«ä¸¦ã¹ã‚‹ï¼ˆãƒœãƒ¼ãƒŠã‚¹å€™è£œã¯æœ€å¾Œã«è¡¨ç¤ºï¼‰
      </label>
    </div>
    <div class="field">
      <label>
        <input type="checkbox" id="loto-ai-mode" />
        AIäºˆæƒ³ãƒ¢ãƒ¼ãƒ‰ã‚’ä½¿ã†ï¼ˆé »å‡ºï¼‹ç›´è¿‘é‡è¦–ï¼‰
      </label>
      <div class="note">
        AIäºˆæƒ³ãƒ¢ãƒ¼ãƒ‰ã§ã¯ã€è“„ç©ã•ã‚ŒãŸå…¨ãƒãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼ã‚’ã€Œå­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã€ã¨ã—ã¦æ‰±ã„ã€å„æ•°å­—ã®é•·æœŸçš„ãªå‡ºç¾é »åº¦ã¨ç›´è¿‘30å›å‰å¾Œã®ãƒˆãƒ¬ãƒ³ãƒ‰ã‚’åŒæ™‚ã«è§£æã—ã¾ã™ã€‚äººå·¥çŸ¥èƒ½ã®æ·±å±¤å­¦ç¿’ã‚’ã‚¤ãƒ¡ãƒ¼ã‚¸ã—ãŸé‡ã¿ä»˜ãç¢ºç‡ãƒ¢ãƒ‡ãƒ«ã«ã‚ˆã‚Šã€ã‚ˆãå‡ºã¦ã„ã‚‹æ•°å­—ã‚„æœ€è¿‘ã«ãªã£ã¦å‡ºç¾ãŒå¢—ãˆã¦ã„ã‚‹æ•°å­—ã®é‡ã¿ã‚’é«˜ã‚ã€ãƒ©ãƒ³ãƒ€ãƒ æŠ½é¸ã«ãƒã‚¤ã‚¢ã‚¹ã‚’ã‹ã‘ã¦æœ¬æ•°å­—6å€‹ï¼‹ãƒœãƒ¼ãƒŠã‚¹å€™è£œ1å€‹ã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã™ã€‚çµ±è¨ˆçš„ãªå‚¾å‘ã‚’æœ€å¤§é™ã«åæ˜ ã—ãŸâ€œAIé¢¨äºˆæƒ³ã‚¨ãƒ³ã‚¸ãƒ³â€ã§ã™ãŒã€ã‚ãã¾ã§ã‚‚éŠã³ç”¨ã®è§£ææ©Ÿèƒ½ã§ã‚ã‚Šã€å½“ã›ã‚“ã‚’ä¿è¨¼ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚<br>
        éå»ãƒ‡ãƒ¼ã‚¿ãŒä¸€ä»¶ã‚‚ç™»éŒ²ã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã€é€šå¸¸ã®å®Œå…¨ãƒ©ãƒ³ãƒ€ãƒ æŠ½é¸ã¨ãªã‚Šã¾ã™ã€‚
      </div>
    </div>
    <button onclick="generateLoto()">AIãŠã¾ã‹ã›ã§äºˆæƒ³ã™ã‚‹</button>

    <div class="field" style="margin-top:4px;">
      <label>äºˆæƒ³çµæœï¼ˆã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤ºï¼‰</label>
      <div id="loto-result-icons"></div>
      <div class="note">
        ã€1å£ç›®ã€‘ã®å³ã«ä¸¦ã‚“ã§ã„ã‚‹ä¸¸ã„ç‰ãŒæœ¬æ•°å­—ã€
        <span class="ball ball-bonus" style="vertical-align:middle;">07</span> ã®ã‚ˆã†ãªæ°´è‰²ã®ç‰ãŒãƒœãƒ¼ãƒŠã‚¹å€™è£œã§ã™ã€‚
      </div>
    </div>
    <div class="field" style="margin-top:4px;">
      <label>ã‚¹ãƒ­ãƒƒãƒˆæ¼”å‡ºã§1å£æ±ºå®š</label>
      <div class="note">
        AIè§£æã®é‡ã¿ã‚’ä½¿ã£ã¦ã€æœ¬æ•°å­—6å€‹ï¼‹ãƒœãƒ¼ãƒŠã‚¹å€™è£œ1å€‹ã‚’ã‚¹ãƒ­ãƒƒãƒˆé¢¨ã«æ±ºã‚ã¾ã™ã€‚<br>
        éå»ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã¯å®Œå…¨ãƒ©ãƒ³ãƒ€ãƒ æŠ½é¸ã«ãªã‚Šã¾ã™ã€‚
      </div>
      <button type="button" id="loto-slot-btn" onclick="startLotoSlot()">ğŸ° ã‚¹ãƒ­ãƒƒãƒˆæ¼”å‡ºã§æ±ºå®š</button>
      <div class="slot-row" style="margin-top:4px;">
        <div class="slot-cell" id="slot-main-0">--</div>
        <div class="slot-cell" id="slot-main-1">--</div>
        <div class="slot-cell" id="slot-main-2">--</div>
        <div class="slot-cell" id="slot-main-3">--</div>
        <div class="slot-cell" id="slot-main-4">--</div>
        <div class="slot-cell" id="slot-main-5">--</div>
        <div class="slot-cell slot-bonus" id="slot-bonus">--</div>
      </div>
    </div>

    <div class="field" style="margin-top:4px;">
      <label>AIã‚³ãƒ¡ãƒ³ãƒˆï¼ˆãªãœã“ã®æ•°å­—ã«ãªã£ãŸã‹ã®ç°¡å˜ãªèª¬æ˜ï¼‰</label>
      <textarea id="loto-comment" placeholder="ã“ã“ã«å„å£ã®è§£èª¬ãŒè¡¨ç¤ºã•ã‚Œã¾ã™"></textarea>
    </div>
  </div>

  <!-- éå»ãƒ‡ãƒ¼ã‚¿è§£æ -->
  <div id="panel-analysis" class="card hidden">
    <div class="field">
      <div style="margin-bottom:6px;">ãƒ­ãƒˆ6ã®éå»å½“ã›ã‚“ç•ªå·ã‚’è²¼ã‚Šä»˜ã‘ã¦è§£æã—ã¾ã™</div>
      <div class="note">
        â–¼å¯¾å¿œã—ã¦ã„ã‚‹ã‚³ãƒ”ãƒšå½¢å¼â‘ ï¼ˆ1å›åˆ†ãŒ4è¡Œï¼‰<br>
        å›å·\tç¬¬1969å›<br>
        æŠ½ã›ã‚“æ—¥\t2025/01/30<br>
        æœ¬æ•°å­—\t3\t7\t12\t13\t35\t38<br>
        ãƒœãƒ¼ãƒŠã‚¹æ•°å­—\t(24)<br><br>
        â–¼å¯¾å¿œã—ã¦ã„ã‚‹ã‚³ãƒ”ãƒšå½¢å¼â‘¡ï¼ˆä¸€è¦§å½¢å¼ï¼‰<br>
        å›å·\tæŠ½ã›ã‚“æ—¥\tæœ¬æ•°å­—\tãƒœãƒ¼ãƒŠã‚¹æ•°å­—<br>
        ç¬¬1641å›\t2021/11/25\t2\t5\t7\t12\t16\t20\t33<br>
        ç¬¬1642å›\t2021/11/29\t5\t15\t16\t24\t34\t39\t13<br>
        ç¬¬1643å›\t2021/12/02\t10\t11\t12\t15\t16\t40\t33<br>
        ç¬¬1644å›\t2021/12/06\t1\t9\t14\t28\t32\t40\t15<br><br>
        ã©ã¡ã‚‰ã®å½¢å¼ã‚‚æ··ãœã¦è²¼ã‚Šä»˜ã‘OKã§ã™ã€‚<br>
        ãƒœãƒ¼ãƒŠã‚¹æ•°å­—ã‚‚å‡ºç¾å›æ•°ã«å«ã‚ã¦AIäºˆæƒ³ã«ä½¿ã„ã¾ã™ã€‚
      </div>
    </div>

    <div class="field">
      <label for="history-input">â‘  ãƒ­ãƒˆ6éå»ãƒ‡ãƒ¼ã‚¿å…¥åŠ›æ¬„ï¼ˆæ–°ã—ãè¿½åŠ ã™ã‚‹åˆ†ã ã‘è²¼ã‚‹ï¼‰</label>
      <textarea id="history-input" placeholder="ã“ã“ã«æ–°ã—ãè¿½åŠ ã™ã‚‹å›ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ”ãƒšã—ã¦ãã ã•ã„"></textarea>
    </div>
    <button onclick="analyzeHistory()">ã“ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã—ã¦AIè§£æã™ã‚‹ï¼ˆãƒãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼ã«è²¯ã‚ã‚‹ï¼‰</button>

    <div class="field" style="margin-top:10px;">
      <div class="note">â‘¡ AIè§£æçµæœï¼ˆã“ã‚Œã¾ã§è²¯ã‚ãŸå…¨ãƒ‡ãƒ¼ã‚¿ã§é›†è¨ˆï¼‰</div>
      <div id="history-summary" class="summary-box"></div>
    </div>

    <!-- æ•°å­—åˆ¥å‡ºç¾å›æ•°ã‚°ãƒ©ãƒ• -->
    <div class="field" style="margin-top:10px;">
      <div class="note">æ•°å­—åˆ¥ å‡ºç¾å›æ•°ã‚°ãƒ©ãƒ•ï¼ˆæœ¬æ•°å­—ï¼‹ãƒœãƒ¼ãƒŠã‚¹ï¼‰</div>
      <div style="height:220px;">
        <canvas id="freqChart"></canvas>
      </div>
      <div class="note">
        æ¨ªè»¸ï¼š1ã€œ43ã®æ•°å­— / ç¸¦è»¸ï¼šã“ã‚Œã¾ã§ã®å‡ºç¾å›æ•°ï¼ˆæœ¬æ•°å­—ï¼‹ãƒœãƒ¼ãƒŠã‚¹æ•°å­—ã‚’åˆç®—ï¼‰<br>
        ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã™ã‚‹ãŸã³ã«è‡ªå‹•æ›´æ–°ã•ã‚Œã¾ã™ã€‚
      </div>
    </div>

    <div class="field" id="history-list-section" style="margin-top:10px;">
      <div class="note">â‘¢ ãƒãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼ä¸€è¦§ï¼ˆå›å·ã¤ãï¼ä¸Šï¼šæ–°ã—ã„ãƒ»ä¸‹ï¼šå¤ã„ï¼‰</div>
      <div id="history-table-wrap" class="history-table-wrap hidden">
        <table class="history-table">
          <thead>
            <tr>
              <th style="width:90px;">å›å·</th>
              <th>æœ¬æ•°å­—ï¼ˆ6å€‹ï¼‰</th>
              <th>ãƒœãƒ¼ãƒŠã‚¹</th>
            </tr>
          </thead>
          <tbody id="history-table-body">
          </tbody>
        </table>
      </div>
      <div class="note">
        â€»ã“ã“ã¯ã€Œã“ã‚Œã¾ã§è¿½åŠ ã—ãŸãƒ‡ãƒ¼ã‚¿ã®ä¸€è¦§ã€ã‚’è¦‹ã‚‹ã ã‘ã®å ´æ‰€ã§ã™ã€‚<br>
        ã€€æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚’è²¼ã‚‹ã¨ãã¯ã€ä¸Šã®ã€Œâ‘ å…¥åŠ›æ¬„ã€ã«è²¼ã£ã¦ãã ã•ã„ã€‚<br>
        ã€€åŒã˜å›ã‚’äºŒé‡ã«è²¼ã‚Šä»˜ã‘ã¦ã€Œè¿½åŠ ã€ã™ã‚‹ã¨ã€äºŒé‡ã‚«ã‚¦ãƒ³ãƒˆã•ã‚Œã¾ã™ã€‚
      </div>
    </div>

    <!-- éå»ãƒ‡ãƒ¼ã‚¿å…¨ã‚¯ãƒªã‚¢ -->
    <div class="field" style="margin-top:10px;">
      <button class="secondary" onclick="clearAllHistory()">éå»ãƒ‡ãƒ¼ã‚¿ã‚’ã™ã¹ã¦ã‚¯ãƒªã‚¢ã—ã¦åˆæœŸçŠ¶æ…‹ã«æˆ»ã™</button>
      <div class="note">
        ã“ã®ç«¯æœ«ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ãƒ­ãƒˆ6ã®éå»ãƒ‡ãƒ¼ã‚¿ï¼ˆlocalStorageï¼‰ã‚’å…¨å‰Šé™¤ã—ã€<br>
        JavaScript å†…ã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹ DEFAULT_RAW_DRAWS ã ã‘ã®çŠ¶æ…‹ã«ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã€‚<br>
        â€»æœ¬æ°—ãƒ‡ãƒ¼ã‚¿ã‚’ DEFAULT_RAW_DRAWS ã«ç„¼ãè¾¼ã‚“ã ã‚ã¨ã«æŠ¼ã™ã¨ã€ãã®æœ¬æ°—ãƒ‡ãƒ¼ã‚¿ã ã‘ã®çŠ¶æ…‹ã«æˆ»ã›ã¾ã™ã€‚
      </div>
    </div>

    <!-- â‘£ é–‹ç™ºè€…å‘ã‘ï¼šåˆæœŸãƒ‡ãƒ¼ã‚¿JSON/JSå‡ºåŠ› -->
    <div class="field" style="margin-top:10px%;">
      <label>â‘£ é–‹ç™ºè€…å‘ã‘ï¼šåˆæœŸãƒ‡ãƒ¼ã‚¿JSON/JSå‡ºåŠ›</label>
      <textarea id="dev-default-json" placeholder="ã“ã“ã«ã€ä»Šã®å…¨ãƒ‡ãƒ¼ã‚¿ã‚’åˆæœŸãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦åŸ‹ã‚è¾¼ã‚€ãŸã‚ã®ã‚³ãƒ¼ãƒ‰ãŒå‡ºã¦ãã¾ã™"></textarea>
      <button class="secondary" onclick="exportDefaultJs()">ä»Šã®å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ã€åˆæœŸãƒ‡ãƒ¼ã‚¿ç”¨ã‚³ãƒ¼ãƒ‰ã€ã¨ã—ã¦å‡ºåŠ›</button>
      <div class="note">
        ã™ã¹ã¦ã®éå»ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ã—çµ‚ã‚ã£ãŸã‚‰ã€ã“ã®ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚<br>
        ä¸‹ã®æ¬„ã«ã€Œconst DEFAULT_RAW_DRAWS = [...] ;ã€ã¨ã„ã†ã‚³ãƒ¼ãƒ‰ãŒå‡ºã‚‹ã®ã§ã€<br>
        ãã‚Œã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ index.html ã® DEFAULT_RAW_DRAWS å®šç¾©éƒ¨åˆ†ã¨å·®ã—æ›¿ãˆã‚Œã°ã€<br>
        æ¬¡å›ã‹ã‚‰èª°ãŒé–‹ã„ã¦ã‚‚ã€ãã®æœ¬æ°—ãƒ‡ãƒ¼ã‚¿ãŒåˆæœŸçŠ¶æ…‹ã¨ã—ã¦èª­ã¿è¾¼ã¾ã‚Œã¾ã™ã€‚
      </div>
    </div>

    <div class="field" style="margin-top:10px;">
      <button class="secondary" onclick="openRakuten()">æ¥½å¤©ã®éå»å½“ã›ã‚“ç•ªå·ãƒšãƒ¼ã‚¸ã‚’é–‹ã</button>
      <div class="note" style="margin-top:4px;">
        <a href="https://takarakuji.rakuten.co.jp/backnumber/loto6_past/" target="_blank" rel="noopener noreferrer">
          https://takarakuji.rakuten.co.jp/backnumber/loto6_past/
        </a>
      </div>

      <button class="secondary" style="margin-top:8px;" onclick="openSougaku()">ãƒ­ãƒˆ6å½“é¸æ•°å­—ä¸€è¦§ï¼ˆå…¨å›ï¼‰ã‚’é–‹ã</button>
      <div class="note" style="margin-top:4px;">
        <a href="http://sougaku.com/loto6/data/list1/" target="_blank" rel="noopener noreferrer">
          http://sougaku.com/loto6/data/list1/
        </a>
      </div>
    </div>

    <div class="note" style="margin-top:8px;">
      â€»ã“ã®è§£æã¯ã€ã€Œã‚ˆãå‡ºã¦ã„ã‚‹æ•°å­—ã€ã€Œé€£ç¶šæ•°å­—ã€ã€Œå¼•ã£å¼µã‚Šæ•°å­—ã€<br>
      ã€Œå¥‡æ•°å¶æ•°æ¯”ç‡ã€ã€Œæ•°å­—ã®åˆè¨ˆã€ã€Œãƒ–ãƒ­ãƒƒã‚¯åˆ¥ï¼ˆ1ã€œ22ï¼23ã€œ43ï¼‰ã€ãªã©ã‚’<br>
      ç°¡å˜ã«é›†è¨ˆã™ã‚‹AIé¢¨ãƒ­ã‚¸ãƒƒã‚¯ã§ã™ã€‚å®Ÿéš›ã®å½“ã›ã‚“ç¢ºç‡ãŒä¸ŠãŒã‚‹ä¿è¨¼ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
    </div>
  </div>

  <div class="card">
    <div class="note">
      ãƒ»ã“ã®ãƒ„ãƒ¼ãƒ«ã¯ãƒ­ãƒˆ6å°‚ç”¨ã§ã™ã€‚<br />
      ãƒ»ã‚ãã¾ã§çµ±è¨ˆçš„ãªâ€œéŠã³â€ã¨ã—ã¦ã”åˆ©ç”¨ãã ã•ã„ã€‚è²·ã„éãã«ã¯ã”æ³¨æ„ã‚’ã€‚<br />
      ãƒ»äºˆæƒ³çµæœã¯ã€Œãƒ¡ãƒ¢ã€ã‚¢ãƒ—ãƒªã‚„Excelã«è²¼ã‚Šä»˜ã‘ã¦ä¿å­˜ã§ãã¾ã™ã€‚
    </div>
  </div>

  <script>
    // ===== ã‚°ãƒ­ãƒ¼ãƒãƒ«ï¼ˆç´¯ç©ãƒ‡ãƒ¼ã‚¿ï¼‰ =====
    const LOCAL_STORAGE_KEY = "loto6AiLabState_v1";

    // åˆæœŸãƒ‡ãƒ¼ã‚¿ï¼ˆä»Šã¯ç©ºã€‚â‘£ã§å‡ºã—ãŸã‚³ãƒ¼ãƒ‰ã«å·®ã—æ›¿ãˆOKï¼‰
    const DEFAULT_RAW_DRAWS = [];

    let lotoHistoryCounts = new Array(44).fill(0); // 1ã€œ43ã®å‡ºç¾å›æ•°ï¼ˆæœ¬æ•°å­—ï¼‹ãƒœãƒ¼ãƒŠã‚¹ï¼‰
    let lotoHistoryTotal = 0; // å…¨ã¦ã®æ•°å­—ã®ç·æ•°ï¼ˆæœ¬æ•°å­—6Ã—å›æ•°ï¼‹ãƒœãƒ¼ãƒŠã‚¹ï¼‰
    // { round: number|null, nums: [6], bonus: number|null, index: number }
    let lotoDraws = [];
    let nextIndex = 0;

    // æ£’ã‚°ãƒ©ãƒ•ï¼ˆChart.jsï¼‰ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
    let freqChart = null;

    // ã‚¹ãƒ­ãƒƒãƒˆæ¼”å‡ºç”¨
    let slotTimer = null;
    let slotStep = 0;
    let slotTargetMain = [];
    let slotTargetBonus = null;

    // ----- ä¿å­˜ãƒ»èª­ã¿è¾¼ã¿ -----
    function saveState() {
      try {
        const state = {
          draws: lotoDraws,
          counts: lotoHistoryCounts,
          total: lotoHistoryTotal,
          nextIndex: nextIndex
        };
        localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(state));
      } catch (e) {
        console.error("saveState failed", e);
      }
    }

    function loadState() {
      // 1) ã¾ãš localStorage ã‚’å„ªå…ˆ
      try {
        const raw = localStorage.getItem(LOCAL_STORAGE_KEY);
        if (raw) {
          const state = JSON.parse(raw);
          if (state && Array.isArray(state.draws) && Array.isArray(state.counts)) {
            // draws å¾©å…ƒ
            lotoDraws = state.draws
              .filter(d => d && Array.isArray(d.nums))
              .map((d, idx) => ({
                round: (typeof d.round === "number" ? d.round : null),
                nums: d.nums.map(n => parseInt(n, 10)).filter(n => !isNaN(n)),
                bonus: (typeof d.bonus === "number" && !isNaN(d.bonus)) ? d.bonus : null,
                index: (typeof d.index === "number" ? d.index : idx)
              }));

            // counts å¾©å…ƒ
            lotoHistoryCounts = new Array(44).fill(0);
            for (let i = 0; i < 44; i++) {
              if (state.counts && typeof state.counts[i] === "number") {
                lotoHistoryCounts[i] = state.counts[i];
              }
            }

            lotoHistoryTotal = (typeof state.total === "number" ? state.total : 0);
            nextIndex = (typeof state.nextIndex === "number" ? state.nextIndex : lotoDraws.length);

            renderHistoryTable();
            updateSummary();
            return;
          }
        }
      } catch (e) {
        console.error("loadState(localStorage) failed", e);
      }

      // 2) localStorage ã«ä½•ã‚‚ãªã„æ–°ã—ã„ç«¯æœ«ç”¨ï¼šåˆæœŸãƒ‡ãƒ¼ã‚¿ã‚’é©ç”¨
      lotoHistoryCounts = new Array(44).fill(0);
      lotoHistoryTotal = 0;
      lotoDraws = [];
      nextIndex = 0;

      if (Array.isArray(DEFAULT_RAW_DRAWS) && DEFAULT_RAW_DRAWS.length > 0) {
        DEFAULT_RAW_DRAWS.forEach(dRaw => {
          if (!dRaw || !Array.isArray(dRaw.nums)) return;
          const numsSorted = dRaw.nums
            .map(n => parseInt(n, 10))
            .filter(n => !isNaN(n) && n >= 1 && n <= 43)
            .slice(0, 6)
            .sort((a, b) => a - b);

          if (numsSorted.length !== 6) return;

          const bonus = (typeof dRaw.bonus === "number" && dRaw.bonus >= 1 && dRaw.bonus <= 43)
            ? dRaw.bonus
            : null;

          const draw = {
            round: (typeof dRaw.round === "number" ? dRaw.round : null),
            nums: numsSorted,
            bonus: bonus,
            index: nextIndex++
          };
          lotoDraws.push(draw);

          numsSorted.forEach(n => {
            lotoHistoryCounts[n] = (lotoHistoryCounts[n] || 0) + 1;
            lotoHistoryTotal++;
          });
          if (bonus !== null) {
            lotoHistoryCounts[bonus] = (lotoHistoryCounts[bonus] || 0) + 1;
            lotoHistoryTotal++;
          }
        });

        saveState();
      }

      renderHistoryTable();
      updateSummary();
    }

    // ===== ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ =====
    function showTab(name) {
      const homePanel = document.getElementById("panel-home");
      const lotoPanel = document.getElementById("panel-loto");
      const analysisPanel = document.getElementById("panel-analysis");
      const tabHome = document.getElementById("tab-home");
      const tabLoto = document.getElementById("tab-loto");
      const tabAnalysis = document.getElementById("tab-analysis");

      homePanel.classList.add("hidden");
      lotoPanel.classList.add("hidden");
      analysisPanel.classList.add("hidden");
      tabHome.classList.remove("active");
      tabLoto.classList.remove("active");
      tabAnalysis.classList.remove("active");

      if (name === "home") {
        homePanel.classList.remove("hidden");
        tabHome.classList.add("active");
      } else if (name === "loto") {
        lotoPanel.classList.remove("hidden");
        tabLoto.classList.add("active");
      } else {
        analysisPanel.classList.remove("hidden");
        tabAnalysis.classList.add("active");
      }
    }

    // ãƒ›ãƒ¼ãƒ  â†’ ã€Œâ‘¢ ãƒãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼ä¸€è¦§ã‚’è¦‹ã‚‹ã€å°‚ç”¨ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
    function goToHistoryList() {
      showTab('analysis');

      setTimeout(function () {
        const el = document.getElementById("history-list-section");
        if (el) {
          el.scrollIntoView({
            behavior: "smooth",
            block: "start"
          });
        }
      }, 50);
    }

    // ===== AIç”¨ã®é‡ã¿è¨ˆç®—ï¼ˆç·å‡ºç¾ï¼‹ç›´è¿‘30å›ï¼‰ =====
    function computeAiWeights() {
      const weights = new Array(44).fill(1); // æœ€ä½1ã¯æŒãŸã›ã‚‹

      // å…¨æœŸé–“ã®å‡ºç¾å›æ•°
      for (let n = 1; n <= 43; n++) {
        const total = lotoHistoryCounts[n] || 0;
        weights[n] += total * 0.4;
      }

      // ç›´è¿‘30å›ã®å‡ºç¾ã‚«ã‚¦ãƒ³ãƒˆ
      const recentCounts = new Array(44).fill(0);
      const recentWindow = 30;
      const start = Math.max(0, lotoDraws.length - recentWindow);
      for (let i = start; i < lotoDraws.length; i++) {
        const d = lotoDraws[i];
        if (!d) continue;
        d.nums.forEach(n => {
          if (n >= 1 && n <= 43) recentCounts[n]++;
        });
        if (d.bonus !== null && d.bonus >= 1 && d.bonus <= 43) {
          recentCounts[d.bonus]++;
        }
      }
      for (let n = 1; n <= 43; n++) {
        const r = recentCounts[n] || 0;
        weights[n] += r * 1.2;
      }

      return weights;
    }

    // é »å‡ºTOP10ï¼ˆæœ¬æ•°å­—ï¼‹ãƒœãƒ¼ãƒŠã‚¹ï¼‰
    function getTopFrequentNumbers(limit = 10) {
      const items = [];
      for (let n = 1; n <= 43; n++) {
        items.push({ num: n, count: lotoHistoryCounts[n] || 0 });
      }
      items.sort((a, b) => b.count - a.count);
      const top = items.filter(x => x.count > 0).slice(0, limit);
      return top.map(x => x.num);
    }

    function pad2(n) {
      return String(n).padStart(2, "0");
    }

    // ===== ãƒ­ãƒˆ6äºˆæƒ³ï¼ˆã‚¢ã‚¤ã‚³ãƒ³ã‚’ä¸€å€‹ãšã¤å‡ºã™ï¼‰ =====
    function generateLoto() {
      const countInput = document.getElementById("loto-count");
      const sort = document.getElementById("loto-sort").checked;
      const useAI = document.getElementById("loto-ai-mode");
      const commentArea = document.getElementById("loto-comment");
      const iconsContainer = document.getElementById("loto-result-icons");

      let count = parseInt(countInput.value, 10);
      if (isNaN(count) || count < 1) count = 1;
      if (count > 20) count = 20;
      countInput.value = count;

      const comments = [];
      iconsContainer.innerHTML = "";

      const aiEnabled = (useAI && useAI.checked && lotoHistoryTotal > 0);
      const topNums = getTopFrequentNumbers(10);
      const topSet = {};
      topNums.forEach(n => { topSet[n] = true; });

      const aiWeights = aiEnabled ? computeAiWeights() : null;

      const results = [];

      for (let i = 0; i < count; i++) {
        let mainNums;
        if (aiEnabled) {
          mainNums = generateSmartLoto6(aiWeights);
        } else {
          mainNums = generateRandomLoto6();
        }

        let bonus;
        if (aiEnabled) {
          bonus = generateWeightedBonus(aiWeights, mainNums);
        } else {
          bonus = generateRandomBonus(mainNums);
        }

        let displayMain = mainNums.slice();
        if (sort) {
          displayMain.sort(function(a, b) { return a - b; });
        }

        // AIã‚³ãƒ¡ãƒ³ãƒˆ
        let cmt = "ã€" + (i + 1) + "å£ç›®ã€‘";
        if (aiEnabled) {
          const strong = displayMain.filter(n => topSet[n]);
          const sum = displayMain.reduce((a, b) => a + b, 0);
          let odd = 0, even = 0;
          displayMain.forEach(n => { if (n % 2 === 0) even++; else odd++; });

          if (strong.length > 0) {
            cmt += "é »å‡ºæ•°å­—: " + strong.map(n => pad2(n)).join(", ") + " / ";
          } else {
            cmt += "é »å‡ºæ•°å­—ã¯å°‘ãªã‚ / ";
          }
          cmt += "åˆè¨ˆ: " + sum + " / å¥‡æ•°" + odd + "ãƒ»å¶æ•°" + even + " / ";
          cmt += "å…¨æœŸé–“ï¼‹ç›´è¿‘30å›ã®å‡ºç¾å›æ•°ã‚’é‡ã¿ä»˜ã‘ã—ãŸAIæŠ½é¸ / ";
          cmt += "ãƒœãƒ¼ãƒŠã‚¹å€™è£œ: " + pad2(bonus);
        } else {
          cmt += "AIè§£æãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ã‚ãšã€å®Œå…¨ãƒ©ãƒ³ãƒ€ãƒ ã§ç”Ÿæˆï¼ˆãƒœãƒ¼ãƒŠã‚¹å€™è£œã‚‚å«ã‚€ï¼‰";
        }
        comments.push(cmt);

        results.push({
          index: i,
          main: displayMain,
          bonus: bonus,
          aiEnabled: aiEnabled
        });
      }

      if (commentArea) {
        commentArea.value = comments.join("\n");
      }

      renderLotoIconsAnimated(results, topSet);
    }

    // ===== ã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤ºã‚’ä¸€å€‹ãšã¤å‡ºã™ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ =====
    function renderLotoIconsAnimated(results, topSet) {
      const iconsContainer = document.getElementById("loto-result-icons");
      if (!iconsContainer) return;

      iconsContainer.innerHTML = "";

      const ballInterval = 80;   // ç‰1å€‹ã”ã¨ã®é–“éš”
      const rowExtraDelay = 250; // æ¬¡ã®å£ã«ç§»ã‚‹å‰ã®ä½™ç™½

      let globalDelay = 0;

      results.forEach((res, rowIndex) => {
        const row = document.createElement("div");
        row.style.marginBottom = "4px";

        const labelNode = document.createTextNode("ã€" + (rowIndex + 1) + "å£ç›®ã€‘ ");
        row.appendChild(labelNode);
        iconsContainer.appendChild(row);

        const mainNums = res.main;
        const bonus = res.bonus;
        const aiEnabled = res.aiEnabled;

        // æœ¬æ•°å­— 6å€‹ã‚’ä¸€å€‹ãšã¤å‡ºã™
        mainNums.forEach((n, i) => {
          const delay = globalDelay + i * ballInterval;
          setTimeout(() => {
            const span = document.createElement("span");

            let cls = "ball ball-pop";

            if (aiEnabled) {
              cls += " ball-ai";
              if (topSet && topSet[n]) {
                cls += " ball-ai-strong";
              }
            }

            span.className = cls;
            span.textContent = pad2(n);
            row.appendChild(span);
          }, delay);
        });

        // ãƒœãƒ¼ãƒŠã‚¹ç‰
        const bonusDelay = globalDelay + mainNums.length * ballInterval + ballInterval;
        setTimeout(() => {
          const spanB = document.createElement("span");
          let bonusCls = "ball ball-bonus ball-pop";
          if (aiEnabled) {
            bonusCls += " ball-ai-bonus";
          }
          spanB.className = bonusCls;
          spanB.textContent = pad2(bonus);
          row.appendChild(spanB);
        }, bonusDelay);

        globalDelay = bonusDelay + rowExtraDelay;
      });
    }

    // æ¡ä»¶ä»˜ãAIãƒ­ãƒˆ6ç”Ÿæˆï¼ˆæœ¬æ•°å­—6å€‹ï¼‰
    function generateSmartLoto6(aiWeights) {
      let best = null;
      let bestScore = -1;

      for (let attempt = 0; attempt < 40; attempt++) {
        const nums = generateWeightedLoto6Once(aiWeights);
        const score = evaluateCombination(nums);
        if (best === null || score > bestScore) {
          bestScore = score;
          best = nums;
        }
        if (score >= 1.0) {
          return nums;
        }
      }
      return best || generateWeightedLoto6Once(aiWeights);
    }

    function evaluateCombination(nums) {
      const sum = nums.reduce((a, b) => a + b, 0);
      let odd = 0, even = 0;
      let small = 0, large = 0; // 1ã€œ22 / 23ã€œ43
      nums.forEach(n => {
        if (n % 2 === 0) even++; else odd++;
        if (n <= 22) small++; else large++;
      });

      let score = 0;

      if (sum >= 100 && sum <= 180) score += 0.5;
      else if (sum >= 80 && sum <= 200) score += 0.2;

      const pattern = odd + ":" + even;
      if (pattern === "3:3" || pattern === "2:4" || pattern === "4:2") score += 0.4;
      else score += 0.1;

      const sb = small + ":" + large;
      if (sb === "3:3" || sb === "2:4" || sb === "4:2") score += 0.3;
      else score += 0.1;

      return score;
    }

    function generateRandomLoto6() {
      const nums = [];
      while (nums.length < 6) {
        const n = Math.floor(Math.random() * 43) + 1;
        if (!nums.includes(n)) nums.push(n);
      }
      return nums;
    }

    function generateWeightedLoto6Once(aiWeights) {
      const available = [];
      for (let n = 1; n <= 43; n++) {
        available.push(n);
      }
      const result = [];

      while (result.length < 6 && available.length > 0) {
        let totalWeight = 0;
        const weights = [];
        for (let i = 0; i < available.length; i++) {
          const num = available[i];
          const w = aiWeights[num] || 1;
          weights.push(w);
          totalWeight += w;
        }
        let r = Math.random() * totalWeight;
        let chosenIndex = 0;
        for (let i = 0; i < available.length; i++) {
          r -= weights[i];
          if (r <= 0) {
            chosenIndex = i;
            break;
          }
        }
        const chosenNum = available[chosenIndex];
        result.push(chosenNum);
        available.splice(chosenIndex, 1);
      }
      return result;
    }

    // ãƒœãƒ¼ãƒŠã‚¹å€™è£œï¼ˆAIé‡ã¿ä»˜ãï¼‰
    function generateWeightedBonus(aiWeights, usedMain) {
      const used = {};
      usedMain.forEach(n => used[n] = true);

      const candidates = [];
      const weights = [];
      let totalWeight = 0;

      for (let n = 1; n <= 43; n++) {
        if (used[n]) continue;
        const w = aiWeights[n] || 1;
        candidates.push(n);
        weights.push(w);
        totalWeight += w;
      }

      if (candidates.length === 0) {
        return 1;
      }

      let r = Math.random() * totalWeight;
      for (let i = 0; i < candidates.length; i++) {
        r -= weights[i];
        if (r <= 0) {
          return candidates[i];
        }
      }
      return candidates[candidates.length - 1];
    }

    // ãƒœãƒ¼ãƒŠã‚¹å€™è£œï¼ˆãƒ©ãƒ³ãƒ€ãƒ ï¼‰
    function generateRandomBonus(usedMain) {
      const used = {};
      usedMain.forEach(n => used[n] = true);
      const candidates = [];
      for (let n = 1; n <= 43; n++) {
        if (!used[n]) candidates.push(n);
      }
      if (candidates.length === 0) return 1;
      const idx = Math.floor(Math.random() * candidates.length);
      return candidates[idx];
    }

    // ===== ã‚¹ãƒ­ãƒƒãƒˆæ¼”å‡ºã§1å£æ±ºå®š =====
    function startLotoSlot() {
      const slotMainElems = [];
      for (let i = 0; i < 6; i++) {
        slotMainElems.push(document.getElementById("slot-main-" + i));
      }
      const bonusElem = document.getElementById("slot-bonus");
      if (!bonusElem || slotMainElems.some(el => !el)) {
        console.warn("ã‚¹ãƒ­ãƒƒãƒˆç”¨ã®è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚");
        return;
      }

      const aiCheckbox = document.getElementById("loto-ai-mode");
      const aiEnabled = aiCheckbox && aiCheckbox.checked;

      let mainNums;
      let bonusNum;
      if (aiEnabled && lotoDraws && lotoDraws.length > 0) {
        const aiWeights = computeAiWeights();
        mainNums = generateSmartLoto6(aiWeights);
        mainNums = mainNums.slice().sort((a, b) => a - b);
        bonusNum = generateWeightedBonus(aiWeights, mainNums);
      } else {
        mainNums = generateRandomLoto6().slice().sort((a, b) => a - b);
        bonusNum = generateRandomBonus(mainNums);
      }

      slotTargetMain = mainNums;
      slotTargetBonus = bonusNum;
      slotStep = 0;
      if (slotTimer) {
        clearTimeout(slotTimer);
        slotTimer = null;
      }
      spinSlotStep();
    }

    function spinSlotStep() {
      const maxBase = 20;
      const delay = 80;
      let done = true;

      for (let i = 0; i < 6; i++) {
        const cell = document.getElementById("slot-main-" + i);
        if (!cell) continue;
        if (slotStep < maxBase + i * 5) {
          const val = Math.floor(Math.random() * 43) + 1;
          cell.textContent = pad2(val);
          done = false;
        } else if (slotTargetMain && slotTargetMain[i] != null) {
          cell.textContent = pad2(slotTargetMain[i]);
        }
      }

      const bonusElem = document.getElementById("slot-bonus");
      if (bonusElem) {
        if (slotStep < maxBase + 6 * 5) {
          const val = Math.floor(Math.random() * 43) + 1;
          bonusElem.textContent = pad2(val);
          done = false;
        } else if (slotTargetBonus != null) {
          bonusElem.textContent = pad2(slotTargetBonus);
        }
      }

      slotStep++;
      if (!done) {
        slotTimer = setTimeout(spinSlotStep, delay);
      }
    }

    // ===== éå»ãƒ‡ãƒ¼ã‚¿è§£æï¼ˆè¿½åŠ ï¼†ç´¯ç©ï¼‰ =====
    function analyzeHistory() {
      const input = document.getElementById("history-input").value;
      const summaryElem = document.getElementById("history-summary");

      if (!input.trim()) {
        summaryElem.textContent = "æ–°ã—ãè¿½åŠ ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚";
        return;
      }

      const lines = input.split(/\r?\n/);
      let currentRound = null;
      let currentMain = [];
      let currentBonus = null;
      let newDraws = [];
      let foundSomething = false;

      function commitBlock() {
        if (currentMain.length === 6) {
          const numsSorted = currentMain.slice().sort((a, b) => a - b);
          const draw = {
            round: currentRound,
            nums: numsSorted,
            bonus: (currentBonus !== null && !isNaN(currentBonus)) ? currentBonus : null,
            index: nextIndex++
          };
          newDraws.push(draw);

          numsSorted.forEach(n => {
            if (n >= 1 && n <= 43) {
              lotoHistoryCounts[n] = (lotoHistoryCounts[n] || 0) + 1;
              lotoHistoryTotal++;
            }
          });
          if (draw.bonus !== null && draw.bonus >= 1 && draw.bonus <= 43) {
            lotoHistoryCounts[draw.bonus] = (lotoHistoryCounts[draw.bonus] || 0) + 1;
            lotoHistoryTotal++;
          }
        }
        currentRound = null;
        currentMain = [];
        currentBonus = null;
      }

      lines.forEach(rawLine => {
        const line = rawLine.trim();
        if (!line) return;

        const norm = line
          .replace(/\t/g, " ")
          .replace(/ã€€/g, " ");

        if (/^å›å·\s+æŠ½ã›ã‚“æ—¥\s+æœ¬æ•°å­—/i.test(norm)) {
          if (currentMain.length > 0) {
            commitBlock();
          }
          return;
        }

        if (/ç¬¬\s*\d+\s*å›/.test(norm) &&
            !/^å›å·/.test(norm) &&
            !/^æœ¬æ•°å­—/.test(norm) &&
            !/^ãƒœãƒ¼ãƒŠã‚¹æ•°å­—/.test(norm)) {

          foundSomething = true;
          if (currentMain.length > 0) {
            commitBlock();
          }

          let roundNo = null;
          const rm = norm.match(/ç¬¬\s*(\d+)\s*å›/);
          if (rm) {
            roundNo = parseInt(rm[1], 10);
          }

          const parts = norm.split(/\s+/);
          const numsSeq = [];
          for (let i = 0; i < parts.length; i++) {
            const p = parts[i];
            const n = parseInt(p, 10);
            if (!isNaN(n) && n >= 1 && n <= 43) {
              numsSeq.push(n);
              if (numsSeq.length >= 7) break;
            }
          }

          if (numsSeq.length === 7) {
            const mains = numsSeq.slice(0, 6);
            const bonus = numsSeq[6];

            const numsSorted = mains.slice().sort((a, b) => a - b);
            const draw = {
              round: roundNo,
              nums: numsSorted,
              bonus: bonus,
              index: nextIndex++
            };
            newDraws.push(draw);

            numsSorted.forEach(n => {
              if (n >= 1 && n <= 43) {
                lotoHistoryCounts[n] = (lotoHistoryCounts[n] || 0) + 1;
                lotoHistoryTotal++;
              }
            });
            if (bonus >= 1 && bonus <= 43) {
              lotoHistoryCounts[bonus] = (lotoHistoryCounts[bonus] || 0) + 1;
              lotoHistoryTotal++;
            }
          }

          return;
        }

        if (norm.startsWith("å›å·")) {
          if (currentMain.length > 0) {
            commitBlock();
          }
          foundSomething = true;
          currentRound = null;
          const m = norm.match(/(\d+)/);
          if (m) {
            currentRound = parseInt(m[1], 10);
          }
          return;
        }

        if (norm.startsWith("æœ¬æ•°å­—")) {
          foundSomething = true;
          currentMain = [];
          const parts = norm.split(/\s+/).slice(1);
          parts.forEach(p => {
            const n = parseInt(p, 10);
            if (!isNaN(n) && n >= 1 && n <= 43 && currentMain.length < 6) {
              currentMain.push(n);
            }
          });
          return;
        }

        if (norm.startsWith("ãƒœãƒ¼ãƒŠã‚¹æ•°å­—")) {
          foundSomething = true;
          const m = norm.replace(/[()ï¼ˆï¼‰]/g, " ").match(/(\d+)/);
          if (m) {
            currentBonus = parseInt(m[1], 10);
          }
          return;
        }
      });

      if (currentMain.length > 0) {
        commitBlock();
      }

      if (!foundSomething || newDraws.length === 0) {
        summaryElem.textContent = "å¯¾å¿œå½¢å¼ã¨ã—ã¦èªè­˜ã§ãã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚å…¥åŠ›å½¢å¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚";
        return;
      }

      newDraws.forEach(draw => lotoDraws.push(draw));

      document.getElementById("history-input").value = "";

      renderHistoryTable();
      updateSummary();
      saveState();
    }

    function renderHistoryTable() {
      const tbody = document.getElementById("history-table-body");
      const wrap = document.getElementById("history-table-wrap");

      tbody.innerHTML = "";
      if (lotoDraws.length === 0) {
        wrap.classList.add("hidden");
        return;
      }

      const sorted = lotoDraws.slice().sort((a, b) => {
        if (a.round !== null && b.round !== null && a.round !== b.round) {
          return b.round - a.round;
        }
        return b.index - a.index;
      });

      sorted.forEach(draw => {
        const tr = document.createElement("tr");

        const tdRound = document.createElement("td");
        if (draw.round !== null && !isNaN(draw.round)) {
          tdRound.textContent = "ç¬¬" + draw.round + "å›";
        } else {
          tdRound.textContent = "No." + (draw.index + 1);
        }
        tr.appendChild(tdRound);

        const tdNums = document.createElement("td");
        draw.nums.forEach(n => {
          const span = document.createElement("span");
          span.className = "ball";
          span.textContent = pad2(n);
          tdNums.appendChild(span);
        });
        tr.appendChild(tdNums);

        const tdBonus = document.createElement("td");
        if (draw.bonus !== null && !isNaN(draw.bonus)) {
          const spanB = document.createElement("span");
          spanB.className = "ball ball-bonus";
          spanB.textContent = pad2(draw.bonus);
          tdBonus.appendChild(spanB);
        } else {
          tdBonus.textContent = "-";
        }
        tr.appendChild(tdBonus);

        tbody.appendChild(tr);
      });

      wrap.classList.remove("hidden");
    }

    function updateSummary() {
      const summaryElem = document.getElementById("history-summary");

      const items = [];
      for (let n = 1; n <= 43; n++) {
        items.push({ num: n, count: lotoHistoryCounts[n] || 0 });
      }
      items.sort((a, b) => b.count - a.count);
      const top = items.slice(0, 10);
      const bottom = items.slice(-10).filter(x => x.count > 0);
      const never = items.filter(x => x.count === 0).map(x => x.num);

      let drawsWithConsecutive = 0;
      const consecutivePairCounts = {};
      let drawsWithPull = 0;
      const pullCounts = {};

      let oddTotal = 0;
      let evenTotal = 0;
      const sumRanges = { low: 0, mid: 0, high: 0, veryhigh: 0 };
      const blockCounts = { b1: 0, b2: 0, b3: 0, b4: 0 };

      for (let i = 0; i < lotoDraws.length; i++) {
        const nums = lotoDraws[i].nums;
        let s = 0;
        let hasConsecutive = false;

        for (let j = 0; j < nums.length; j++) {
          const n = nums[j];
          s += n;
          if (n % 2 === 0) evenTotal++; else oddTotal++;
          if (n >= 1 && n <= 10) blockCounts.b1++;
          else if (n >= 11 && n <= 22) blockCounts.b2++;
          else if (n >= 23 && n <= 33) blockCounts.b3++;
          else blockCounts.b4++;
        }

        for (let j = 0; j < nums.length - 1; j++) {
          if (nums[j + 1] === nums[j] + 1) {
            hasConsecutive = true;
            const key = nums[j] + "-" + nums[j + 1];
            consecutivePairCounts[key] = (consecutivePairCounts[key] || 0) + 1;
          }
        }
        if (hasConsecutive) drawsWithConsecutive++;

        if (s <= 120) sumRanges.low++;
        else if (s <= 180) sumRanges.mid++;
        else if (s <= 240) sumRanges.high++;
        else sumRanges.veryhigh++;

        if (i > 0) {
          const prev = lotoDraws[i - 1].nums;
          const prevSet = {};
          prev.forEach(n => prevSet[n] = true);
          let hasPull = false;
          nums.forEach(n => {
            if (prevSet[n]) {
              hasPull = true;
              pullCounts[n] = (pullCounts[n] || 0) + 1;
            }
          });
          if (hasPull) drawsWithPull++;
        }
      }

      const consecutiveItems = Object.keys(consecutivePairCounts).map(key => ({
        pair: key,
        count: consecutivePairCounts[key]
      })).sort((a, b) => b.count - a.count).slice(0, 5);

      const pullItems = Object.keys(pullCounts).map(num => ({
        num: parseInt(num, 10),
        count: pullCounts[num]
      })).sort((a, b) => b.count - a.count).slice(0, 5);

      const totalDraws = lotoDraws.length;
      const totalNumsMain = totalDraws * 6;
      let text = "";

      text += "â—†è§£æã‚µãƒãƒªãƒ¼ï¼ˆã“ã‚Œã¾ã§è¿½åŠ ã—ãŸå…¨ãƒ‡ãƒ¼ã‚¿ï¼‰\n";
      text += "å¯¾è±¡å›æ•°: " + totalDraws + " å›\n";
      text += "å‡ºç¾ã‚«ã‚¦ãƒ³ãƒˆå¯¾è±¡: æœ¬æ•°å­— + ãƒœãƒ¼ãƒŠã‚¹æ•°å­—ï¼ˆAIäºˆæƒ³ã®é‡ã¿ä»˜ã‘ï¼‰\n";

      text += "\nâ–¼å‡ºç¾å›æ•° ä¸Šä½10æ•°å­—ï¼ˆã‚ˆãå‡ºã¦ã„ã‚‹ï¼šæœ¬æ•°å­—ï¼‹ãƒœãƒ¼ãƒŠã‚¹ï¼‰\n";
      top.forEach(x => {
        text += pad2(x.num) + " : " + x.count + " å›\n";
      });

      if (bottom.length > 0) {
        text += "\nâ–¼å‡ºç¾å›æ•° ä¸‹ä½ã®æ•°å­—ï¼ˆã‚ã¾ã‚Šå‡ºã¦ã„ãªã„ãŒä¸€å¿œå‡ºã¦ã„ã‚‹ï¼‰\n";
        bottom.forEach(x => {
          text += pad2(x.num) + " : " + x.count + " å›\n";
        });
      }

      if (never.length > 0) {
        text += "\nâ–¼ä¸€åº¦ã‚‚å‡ºã¦ã„ãªã„æ•°å­—ï¼ˆã“ã®ãƒ‡ãƒ¼ã‚¿ç¯„å›²å†…ï¼‰\n";
        const chunks = [];
        for (let i = 0; i < never.length; i += 10) {
          const part = never.slice(i, i + 10).map(n => pad2(n)).join(" ");
          chunks.push(part);
        }
        text += chunks.join("\n") + "\n";
      }

      if (totalDraws > 0) {
        const consecPct = (drawsWithConsecutive * 100 / totalDraws).toFixed(1);
        const pullPct = (drawsWithPull * 100 / totalDraws).toFixed(1);
        text += "\nâ–¼é€£ç¶šæ•°å­—ï¼ˆn, n+1 ãŒå«ã¾ã‚Œã‚‹å›ï¼‰\n";
        text += "é€£ç¶šæ•°å­—ã‚’å«ã‚€å›: " + drawsWithConsecutive + " å›ï¼ˆ" + consecPct + "%ï¼‰\n";
        if (consecutiveItems.length > 0) {
          text += "ã‚ˆãå‡ºã‚‹é€£ç¶šãƒšã‚¢ ä¸Šä½:\n";
          consecutiveItems.forEach(item => {
            text += " " + item.pair + " : " + item.count + " å›\n";
          });
        }

        text += "\nâ–¼å¼•ã£å¼µã‚Šæ•°å­—ï¼ˆå‰å›ã‹ã‚‰ç¶šã‘ã¦å‡ºãŸæ•°å­—ï¼šæœ¬æ•°å­—ã®ã¿ï¼‰\n";
        text += "å¼•ã£å¼µã‚Šæ•°å­—ã‚’å«ã‚€å›: " + drawsWithPull + " å›ï¼ˆ" + pullPct + "%ï¼‰\n";
        if (pullItems.length > 0) {
          text += "ã‚ˆãå¼•ã£å¼µã‚‰ã‚Œã¦ã„ã‚‹æ•°å­— ä¸Šä½:\n";
          pullItems.forEach(item => {
            text += " " + pad2(item.num) + " : " + item.count + " å›\n";
          });
        }

        const oddPct = (oddTotal * 100 / totalNumsMain).toFixed(1);
        const evenPct = (evenTotal * 100 / totalNumsMain).toFixed(1);
        text += "\nâ–¼å¥‡æ•°ãƒ»å¶æ•°ã®æ¯”ç‡ï¼ˆæœ¬æ•°å­—6å€‹ãƒ™ãƒ¼ã‚¹ï¼‰\n";
        text += "å¥‡æ•°: " + oddTotal + " å€‹ï¼ˆ" + oddPct + "%ï¼‰\n";
        text += "å¶æ•°: " + evenTotal + " å€‹ï¼ˆ" + evenPct + "%ï¼‰\n";

        text += "\nâ–¼åˆè¨ˆå€¤ã®å‚¾å‘ï¼ˆæœ¬æ•°å­—6å€‹ã®åˆè¨ˆï¼‰\n";
        text += "60ã€œ120: " + sumRanges.low + " å›\n";
        text += "121ã€œ180: " + sumRanges.mid + " å›\n";
        text += "181ã€œ240: " + sumRanges.high + " å›\n";
        text += "241ä»¥ä¸Š: " + sumRanges.veryhigh + " å›\n";

        text += "\nâ–¼ãƒ–ãƒ­ãƒƒã‚¯åˆ¥ã®å‡ºç¾ï¼ˆæœ¬æ•°å­—ã®ã¿ï¼‰\n";
        text += "1ã€œ10:  " + blockCounts.b1 + " å€‹\n";
        text += "11ã€œ22: " + blockCounts.b2 + " å€‹\n";
        text += "23ã€œ33: " + blockCounts.b3 + " å€‹\n";
        text += "34ã€œ43: " + blockCounts.b4 + " å€‹\n";
      }

      text += "\nã“ã®è§£æçµæœã‚’ã‚‚ã¨ã«ã€ã€Œãƒ­ãƒˆ6äºˆæƒ³ã€ã‚¿ãƒ–ã§AIäºˆæƒ³ãƒ¢ãƒ¼ãƒ‰ã‚’ONã«ã™ã‚‹ã¨ã€\n";
      text += "æœ¬æ•°å­—ï¼‹ãƒœãƒ¼ãƒŠã‚¹æ•°å­—ã®å‡ºç¾å›æ•°ï¼ˆå…¨æœŸé–“ï¼‹ç›´è¿‘30å›ï¼‰ãŒå¤šã„æ•°å­—ã»ã©\n";
      text += "å°‘ã—ã ã‘é¸ã°ã‚Œã‚„ã™ããªã‚‹ã‚ˆã†ã«é‡ã¿ä»˜ã‘ã—ã¦æŠ½é¸ã—ã¾ã™ã€‚";

      summaryElem.textContent = text;

      updateFrequencyChart();
    }

    function updateFrequencyChart() {
      const canvas = document.getElementById("freqChart");
      if (!canvas) return;

      const ctx = canvas.getContext("2d");

      const labels = [];
      const data = [];
      for (let n = 1; n <= 43; n++) {
        labels.push(String(n).padStart(2, "0"));
        data.push(lotoHistoryCounts[n] || 0);
      }

      const total = data.reduce((a, b) => a + b, 0);
      if (total === 0) {
        if (freqChart) {
          freqChart.data.datasets[0].data = data;
          freqChart.update();
        }
        return;
      }

      if (!freqChart) {
        freqChart = new Chart(ctx, {
          type: "bar",
          data: {
            labels: labels,
            datasets: [
              {
                label: "å‡ºç¾å›æ•°ï¼ˆæœ¬æ•°å­—ï¼‹ãƒœãƒ¼ãƒŠã‚¹ï¼‰",
                data: data
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              x: {
                ticks: {
                  maxRotation: 0,
                  autoSkip: true,
                  maxTicksLimit: 15
                }
              },
              y: {
                beginAtZero: true,
                precision: 0
              }
            },
            plugins: {
              legend: {
                display: false
              }
            }
          }
        });
      } else {
        freqChart.data.datasets[0].data = data;
        freqChart.update();
      }
    }

    // ===== é–‹ç™ºè€…å‘ã‘ï¼šä»Šã®å…¨ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ DEFAULT_RAW_DRAWS ç”¨ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ =====
    function exportDefaultJs() {
      const ta = document.getElementById("dev-default-json");

      if (!lotoDraws || lotoDraws.length === 0) {
        ta.value = "// ã¾ã éå»ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã—ã¦ã‹ã‚‰å†åº¦å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚";
        alert("éå»ãƒ‡ãƒ¼ã‚¿ãŒ0ä»¶ãªã®ã§å‡ºåŠ›ã§ãã¾ã›ã‚“ã€‚å…ˆã«ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚");
        return;
      }

      const arr = lotoDraws.map(d => ({
        round: (typeof d.round === "number" ? d.round : null),
        nums: d.nums,
        bonus: (typeof d.bonus === "number" ? d.bonus : null)
      }));

      const code =
        "// ã“ã“ã‹ã‚‰ä¸‹ã‚’ DEFAULT_RAW_DRAWS ã®å®šç¾©éƒ¨åˆ†ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„\n" +
        "const DEFAULT_RAW_DRAWS = " +
        JSON.stringify(arr, null, 2) +
        ";\n";

      ta.value = code;
      alert("ä»Šã®å…¨ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã€åˆæœŸãƒ‡ãƒ¼ã‚¿ç”¨ã‚³ãƒ¼ãƒ‰ã€ã‚’ç”Ÿæˆã—ã¾ã—ãŸã€‚ã“ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ index.html ã® DEFAULT_RAW_DRAWS å®šç¾©ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚");
    }

    // ===== éå»ãƒ‡ãƒ¼ã‚¿å…¨ã‚¯ãƒªã‚¢ï¼ˆåˆæœŸçŠ¶æ…‹ã«æˆ»ã™ï¼‰ =====
    function clearAllHistory() {
      if (!confirm("ã“ã®ç«¯æœ«ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ãƒ­ãƒˆ6ã®éå»ãƒ‡ãƒ¼ã‚¿ã‚’ã™ã¹ã¦å‰Šé™¤ã—ã¦ã€åˆæœŸçŠ¶æ…‹ã«æˆ»ã—ã¾ã™ã€‚\nã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ")) {
        return;
      }
      try {
        localStorage.removeItem(LOCAL_STORAGE_KEY);
      } catch (e) {
        console.error("clear localStorage failed", e);
      }
      lotoHistoryCounts = new Array(44).fill(0);
      lotoHistoryTotal = 0;
      lotoDraws = [];
      nextIndex = 0;

      loadState();
      document.getElementById("history-input").value = "";
      alert("éå»ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã€åˆæœŸçŠ¶æ…‹ã«æˆ»ã—ã¾ã—ãŸã€‚");
    }

    // ===== å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ =====
    function copyResult(textareaId) {
      const ta = document.getElementById(textareaId);
      if (!ta) return;
      ta.select();
      ta.setSelectionRange(0, 99999);
      document.execCommand("copy");
      alert("çµæœã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸã€‚ãƒ¡ãƒ¢ç­‰ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚");
    }

    function openRakuten() {
      window.open("https://takarakuji.rakuten.co.jp/backnumber/loto6_past/", "_blank");
    }

    function openSougaku() {
      window.open("http://sougaku.com/loto6/data/list1/", "_blank");
    }

    (function () {
      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", loadState);
      } else {
        loadState();
      }
    })();
  </script>
</body>
</html>
