<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ãƒ­ãƒˆ6 AIäºˆæƒ³ Webã‚¢ãƒ—ãƒª</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Chart.jsï¼ˆæ£’ã‚°ãƒ©ãƒ•ç”¨ï¼‰ -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Hiragino Sans", "Meiryo", sans-serif;
      background: #f3f4f6;
      color: #111827;
    }
    .app-container {
      display: flex;
      flex-direction: row;
      gap: 12px;
      padding: 12px;
      height: 100vh;
    }
    @media (max-width: 900px) {
      .app-container {
        flex-direction: column;
        height: auto;
      }
    }
    .panel {
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      padding: 12px 14px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .panel-left {
      flex: 1.2;
      min-width: 320px;
    }
    .panel-right {
      flex: 1;
      min-width: 260px;
    }
    h1 {
      font-size: 20px;
      margin: 0 0 6px;
    }
    h2 {
      font-size: 15px;
      margin: 6px 0;
    }
    textarea, input, button, select {
      font-family: inherit;
    }
    textarea {
      width: 100%;
      padding: 6px;
      font-size: 12px;
      resize: vertical;
      border-radius: 6px;
      border: 1px solid #d1d5db;
    }
    .section {
      border-radius: 10px;
      border: 1px solid #e5e7eb;
      padding: 8px 10px;
      background: #f9fafb;
    }
    .section-title {
      font-weight: 600;
      font-size: 13px;
      margin-bottom: 4px;
    }
    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
    }
    button {
      border-radius: 999px;
      border: none;
      padding: 6px 12px;
      font-size: 12px;
      cursor: pointer;
      background: #3b82f6;
      color: white;
      font-weight: 500;
      transition: background 0.15s, transform 0.05s;
      white-space: nowrap;
    }
    button.secondary {
      background: #6b7280;
    }
    button.ghost {
      background: #e5e7eb;
      color: #111827;
    }
    button:hover {
      background: #2563eb;
    }
    button.secondary:hover {
      background: #4b5563;
    }
    button.ghost:hover {
      background: #d1d5db;
    }
    button:active {
      transform: translateY(1px);
    }
    button:disabled {
      opacity: 0.5;
      cursor: default;
      transform: none;
    }
    .small-input {
      width: 60px;
      padding: 4px 6px;
      border-radius: 6px;
      border: 1px solid #d1d5db;
      font-size: 12px;
    }
    .label {
      font-size: 12px;
      color: #4b5563;
    }
    .stats-label {
      font-size: 12px;
      color: #374151;
      margin-top: 2px;
    }
    .mono {
      font-family: "SF Mono", Menlo, Consolas, monospace;
      font-size: 12px;
      white-space: pre-wrap;
    }
    #predictResult, #aiOutput, #slotResult {
      width: 100%;
      min-height: 60px;
      max-height: 150px;
      overflow-y: auto;
      padding: 6px;
      border-radius: 6px;
      border: 1px solid #e5e7eb;
      background: #ffffff;
      font-size: 12px;
    }
    #aiOutput {
      min-height: 120px;
    }
    .pill-label {
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 999px;
      background: #e5e7eb;
      display: inline-block;
      margin-top: 2px;
    }
    .slot-row {
      display: flex;
      gap: 4px;
      margin-top: 4px;
    }
    .slot-cell {
      width: 28px;
      height: 28px;
      border-radius: 6px;
      background: #111827;
      color: #f9fafb;
      font-family: "SF Mono", Menlo, Consolas, monospace;
      font-size: 0.8rem;
      text-align: center;
      line-height: 28px;
    }
    .slot-cell.slot-bonus {
      background: #e6f7ff;
      border: 1px solid #7fb8f2;
      color: #0f172a;
    }
    canvas {
      background: #ffffff;
      border-radius: 10px;
      border: 1px solid #e5e7eb;
      padding: 4px;
    }
    a {
      font-size: 12px;
      color: #2563eb;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- å·¦ãƒ‘ãƒãƒ« -->
    <div class="panel panel-left">
      <h1>ãƒ­ãƒˆ6 AIäºˆæƒ³ãƒ©ãƒœï¼ˆWebç‰ˆï¼‰</h1>

      <!-- å…¬å¼ãƒ‡ãƒ¼ã‚¿ãƒªãƒ³ã‚¯ -->
      <div class="section">
        <div class="section-title">å…¬å¼ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèª</div>
        <div class="row">
          <a href="https://www.mizuhobank.co.jp/retail/takarakuji/check/loto6/" target="_blank" rel="noopener">
            ã¿ãšã»éŠ€è¡Œå…¬å¼ ãƒ­ãƒˆ6çµæœ
          </a>
        </div>
        <div class="row" style="margin-top:2px;">
          <a href="http://sougaku.com/loto6/data/list1/" target="_blank" rel="noopener">
            LOTO6 éå»å½“é¸ç•ªå·ä¸€è¦§ï¼ˆsougaku.comï¼‰
          </a>
        </div>
      </div>

      <!-- ã‚¹ãƒ­ãƒƒãƒˆæ¼”å‡ºï¼ˆã„ã¡ã°ã‚“ä¸Šï¼‰ -->
      <div class="section">
        <div class="section-title">ğŸ° ã‚¹ãƒ­ãƒƒãƒˆæ¼”å‡ºã§å£æ•°æ±ºå®š</div>
        <div class="label">
          AIè§£æï¼ˆéå»ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Œã°é‡ã¿ä»˜ãï¼‰ or å®Œå…¨ãƒ©ãƒ³ãƒ€ãƒ ã§ã€<br>
          æœ¬æ•°å­—6å€‹ï¼‹ãƒœãƒ¼ãƒŠã‚¹å€™è£œ1å€‹ã‚’ã‚¹ãƒ­ãƒƒãƒˆé¢¨ã«æ±ºã‚ã¾ã™ã€‚
        </div>
        <div class="row" style="margin-top:4px;">
          <span class="label">ã‚¹ãƒ­ãƒƒãƒˆå£æ•°ï¼š</span>
          <input id="slotCount" type="number" class="small-input" min="1" max="20" value="1">
          <button id="btnSlot" class="ghost">ğŸ° ã‚¹ãƒ­ãƒƒãƒˆæ¼”å‡ºã§æ±ºå®š</button>
        </div>
        <div class="slot-row" style="margin-top:4px;">
          <div class="slot-cell" id="slot-main-0">--</div>
          <div class="slot-cell" id="slot-main-1">--</div>
          <div class="slot-cell" id="slot-main-2">--</div>
          <div class="slot-cell" id="slot-main-3">--</div>
          <div class="slot-cell" id="slot-main-4">--</div>
          <div class="slot-cell" id="slot-main-5">--</div>
          <div class="slot-cell slot-bonus" id="slot-bonus">--</div>
        </div>
        <div id="slotResult" class="mono" style="margin-top:4px;"></div>
      </div>

      <!-- ãƒ¡ã‚¤ãƒ³ã®ãƒ­ãƒˆ6è¨­å®š -->
      <div class="section">
        <div class="section-title">ãƒ­ãƒˆ6ï¼ˆ1ã€œ43ã‹ã‚‰æœ¬æ•°å­—6å€‹ï¼‹ãƒœãƒ¼ãƒŠã‚¹å€™è£œ1å€‹ï¼‰</div>

        <!-- éå»ãƒ‡ãƒ¼ã‚¿å…¥åŠ› -->
        <div class="section" style="margin-top:6px;">
          <div class="section-title">éå»ã®å½“é¸çµæœï¼ˆã‚³ãƒ”ãƒšï¼‰</div>
          <textarea id="historyInput" rows="7" class="mono" placeholder="ä¾‹ï¼š
ç¬¬1969å› 03 07 12 13 35 38 24
ç¬¬1644å› 01 09 14 28 32 40 15
â€»ã€ç¬¬â—‹å›ã€ã‚„ãƒœãƒ¼ãƒŠã‚¹æ•°å­—ãŒå…¥ã£ã¦ã„ã¦ã‚‚OK
ã€€è¡Œã”ã¨ã«æ•°å­—ã‚’å«ã‚“ã§ã„ã‚Œã°è‡ªå‹•ã§èª­ã¿å–ã‚Šã¾ã™ã€‚"></textarea>
          <div class="row" style="margin-top:4px;">
            <button id="btnLoad">é›†è¨ˆ / ã‚°ãƒ©ãƒ•æ›´æ–°</button>
            <button id="btnClear" class="secondary">éå»ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢</button>
          </div>
          <div id="statsLabel" class="stats-label">
            ç™»éŒ²ãƒ‡ãƒ¼ã‚¿ï¼š0å› / æœ€é »å‡ºãƒˆãƒƒãƒ—6ï¼š-
          </div>
        </div>

        <!-- åŸºæœ¬äºˆæƒ³ -->
        <div class="section" style="margin-top:6px;">
          <div class="section-title">åŸºæœ¬äºˆæƒ³ï¼ˆãƒ©ãƒ³ã‚­ãƒ³ã‚° + ã‚µã‚¤ã‚³ãƒ­ + æŠ½é¸ã‚²ãƒ¼ãƒ ï¼‰</div>
          <div class="row">
            <span class="label">äºˆæƒ³ãƒ¢ãƒ¼ãƒ‰ï¼š</span>
            <label class="label"><input type="radio" name="mode" value="frequency" checked> é »åº¦é‡è¦–</label>
            <label class="label"><input type="radio" name="mode" value="recent"> æœ€è¿‘ã®å‚¾å‘é‡è¦–</label>
            <label class="label"><input type="radio" name="mode" value="cold"> å‡ºã¦ã„ãªã„æ•°å­—é‡è¦–</label>
            <label class="label"><input type="radio" name="mode" value="random"> å®Œå…¨ãƒ©ãƒ³ãƒ€ãƒ </label>
          </div>
          <div class="row" style="margin-top:4px;">
            <span class="label">äºˆæƒ³ã‚»ãƒƒãƒˆæ•°ï¼š</span>
            <input id="predictCount" type="number" class="small-input" min="1" max="20" value="10">
            <button id="btnPredict">äºˆæƒ³ã™ã‚‹ï¼ˆãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤ºï¼‰</button>
          </div>
          <div class="row" style="margin-top:4px;">
            <button id="btnDice" class="ghost">ã‚µã‚¤ã‚³ãƒ­ã§1å£é¸ã¶</button>
            <span id="diceLabel" class="label">ã‚µã‚¤ã‚³ãƒ­çµæœï¼š-</span>
          </div>
          <div class="row" style="margin-top:4px;">
            <button id="btnLottery" class="ghost" disabled>æŠ½é¸ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
            <span id="lotteryLabel" class="label">æŠ½é¸ã‚²ãƒ¼ãƒ çµæœï¼š-</span>
          </div>
          <div id="predictResult" class="mono" style="margin-top:4px;"></div>
        </div>

        <!-- AIã‚¨ãƒ³ã‚¿ãƒ¡äºˆæƒ³ -->
        <div class="section" style="margin-top:6px;">
          <div class="section-title">
            AIã‚¨ãƒ³ã‚¿ãƒ¡äºˆæƒ³ãƒ¢ãƒ¼ãƒ‰
            <span class="pill-label">AIéŠã³æ©Ÿèƒ½</span>
          </div>

          <!-- æ°—åˆ†è¨ºæ–­ -->
          <div class="row">
            <span class="label">ä»Šæ—¥ã®æ°—åˆ†ï¼š</span>
            <label class="label"><input type="radio" name="mood" value="attack"> ğŸ”¥æ”»ã‚ã‚‹</label>
            <label class="label"><input type="radio" name="mood" value="normal" checked> ğŸŒ¿æ™®é€š</label>
            <label class="label"><input type="radio" name="mood" value="defense"> ğŸ›¡å®ˆã‚‹</label>
          </div>
          <div class="row" style="margin-top:4px;">
            <button id="btnMood">æ°—åˆ†AIäºˆæƒ³</button>
          </div>

          <!-- ã‚­ãƒ£ãƒ©åˆ¥ -->
          <div class="row" style="margin-top:8px;">
            <span class="label">AIã‚­ãƒ£ãƒ©ã§äºˆæƒ³ï¼š</span>
          </div>
          <div class="row" style="margin-top:2px;">
            <button id="btnCharWizard" class="ghost">ğŸ§™â€â™‚ï¸ é­”æ³•ä½¿ã„AI</button>
            <button id="btnCharDragon" class="ghost">ğŸ‰ ãƒ‰ãƒ©ã‚´ãƒ³AI</button>
            <button id="btnCharMath" class="ghost">ğŸ§  æ•°å­¦åšå£«AI</button>
            <button id="btnCharGambler" class="ghost">ğŸ¤¡ ã‚®ãƒ£ãƒ³ãƒ–ãƒ©ãƒ¼AI</button>
          </div>

          <!-- ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ / æœ¬æ°— -->
          <div class="row" style="margin-top:8px;">
            <button id="btnStory" class="ghost">ğŸ“– AIã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ¢ãƒ¼ãƒ‰</button>
            <button id="btnStrong" class="ghost">ğŸ’¥ AIæœ¬æ°—äºˆæƒ³</button>
          </div>

          <!-- AIå‡ºåŠ› -->
          <div id="aiOutput" class="mono" style="margin-top:6px;"></div>
        </div>
      </div>
    </div>

    <!-- å³ãƒ‘ãƒãƒ«ï¼ˆã‚°ãƒ©ãƒ•ï¼‰ -->
    <div class="panel panel-right">
      <h2>æ•°å­—ã”ã¨ã®å‡ºç¾å›æ•°ã‚°ãƒ©ãƒ•</h2>
      <div class="label">1ã€œ43ã®æœ¬æ•°å­—ã‚’æ£’ã‚°ãƒ©ãƒ•ã§è¡¨ç¤ºã—ã¾ã™ã€‚</div>
      <div style="flex:1; min-height:260px; margin-top:6px;">
        <canvas id="chartCanvas"></canvas>
      </div>
    </div>
  </div>

  <script>
    // ===== ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ =====
    const MAX_NUMBER = 43;
    let historyData = [];                      // [[nums...], ...]
    let counts = new Array(MAX_NUMBER + 1).fill(0); // 1ã€œ43ã®ã¿ä½¿ç”¨
    let lastPredictions = [];                  // {nums:[...], score:number}[]
    let lastChosenIndex = null;

    let chart = null;
    let lotteryTimer = null;
    let lotterySteps = 0;
    let gameRunning = false;

    // ã‚¹ãƒ­ãƒƒãƒˆç”¨
    let slotTimer = null;
    let slotStep = 0;
    let slotTargetMain = [];
    let slotTargetBonus = null;
    let slotResultSets = [];

    // ===== DOMå‚ç…§ =====
    const historyInput = document.getElementById('historyInput');
    const btnLoad = document.getElementById('btnLoad');
    const btnClear = document.getElementById('btnClear');
    const statsLabel = document.getElementById('statsLabel');

    const btnPredict = document.getElementById('btnPredict');
    const predictCountInput = document.getElementById('predictCount');
    const predictResultDiv = document.getElementById('predictResult');

    const btnDice = document.getElementById('btnDice');
    const diceLabel = document.getElementById('diceLabel');
    const btnLottery = document.getElementById('btnLottery');
    const lotteryLabel = document.getElementById('lotteryLabel');

    const btnMood = document.getElementById('btnMood');
    const btnCharWizard = document.getElementById('btnCharWizard');
    const btnCharDragon = document.getElementById('btnCharDragon');
    const btnCharMath = document.getElementById('btnCharMath');
    const btnCharGambler = document.getElementById('btnCharGambler');
    const btnStory = document.getElementById('btnStory');
    const btnStrong = document.getElementById('btnStrong');
    const aiOutput = document.getElementById('aiOutput');

    const slotCountInput = document.getElementById('slotCount');
    const btnSlot = document.getElementById('btnSlot');
    const slotResultDiv = document.getElementById('slotResult');
    const slotCells = [
      document.getElementById('slot-main-0'),
      document.getElementById('slot-main-1'),
      document.getElementById('slot-main-2'),
      document.getElementById('slot-main-3'),
      document.getElementById('slot-main-4'),
      document.getElementById('slot-main-5')
    ];
    const slotBonusCell = document.getElementById('slot-bonus');

    const chartCanvas = document.getElementById('chartCanvas');

    // ===== ãƒ˜ãƒ«ãƒ‘ãƒ¼ =====
    function pad2(n) {
      return String(n).padStart(2, '0');
    }

    function getSelectedRadio(name, defaultValue) {
      const nodes = document.querySelectorAll(`input[name="${name}"]`);
      for (const n of nodes) {
        if (n.checked) return n.value;
      }
      return defaultValue;
    }

    function randomSample(numbers, k) {
      const arr = numbers.slice();
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr.slice(0, k);
    }

    function weightedRandomChoice(numbers, weights) {
      let total = 0;
      for (const w of weights) total += w;
      let r = Math.random() * total;
      for (let i = 0; i < numbers.length; i++) {
        r -= weights[i];
        if (r <= 0) return numbers[i];
      }
      return numbers[numbers.length - 1];
    }

    function weightedSample(numbers, weights, k) {
      const chosen = new Set();
      while (chosen.size < k) {
        const num = weightedRandomChoice(numbers, weights);
        chosen.add(num);
      }
      return Array.from(chosen);
    }

    function clearAiOutput() {
      aiOutput.textContent = '';
    }

    function appendAiOutput(text) {
      aiOutput.textContent += text + '\n';
      aiOutput.scrollTop = aiOutput.scrollHeight;
    }

    function clearPredictResult() {
      predictResultDiv.textContent = '';
    }

    function updateStatsLabel() {
      const total = historyData.length;
      if (total === 0) {
        statsLabel.textContent = 'ç™»éŒ²ãƒ‡ãƒ¼ã‚¿ï¼š0å› / æœ€é »å‡ºãƒˆãƒƒãƒ—6ï¼š-';
        return;
      }
      const freqPairs = [];
      for (let i = 1; i <= MAX_NUMBER; i++) {
        freqPairs.push({ num: i, cnt: counts[i] });
      }
      freqPairs.sort((a, b) => b.cnt - a.cnt);
      const top6 = freqPairs.slice(0, 6).map(p => `${pad2(p.num)}(${p.cnt})`);
      statsLabel.textContent = `ç™»éŒ²ãƒ‡ãƒ¼ã‚¿ï¼š${total}å› / æœ€é »å‡ºãƒˆãƒƒãƒ—6ï¼š${top6.join('  ')}`;
    }

    // ===== ã‚°ãƒ©ãƒ• =====
    function initChart() {
      const labels = [];
      for (let i = 1; i <= MAX_NUMBER; i++) labels.push(i.toString());
      chart = new Chart(chartCanvas.getContext('2d'), {
        type: 'bar',
        data: {
          labels,
          datasets: [{
            label: 'å‡ºç¾å›æ•°',
            data: labels.map(() => 0)
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            x: {
              title: { display: true, text: 'æ•°å­—' },
              ticks: { autoSkip: true, maxTicksLimit: 22 }
            },
            y: {
              title: { display: true, text: 'å›æ•°' },
              beginAtZero: true
            }
          },
          plugins: {
            legend: { display: false }
          }
        }
      });
    }

    function updateChart() {
      if (!chart) initChart();
      const data = [];
      for (let i = 1; i <= MAX_NUMBER; i++) data.push(counts[i]);
      chart.data.datasets[0].data = data;
      chart.update();
    }

    // ===== éå»ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ =====
    function loadHistory() {
      const text = historyInput.value.trim();
      if (!text) {
        alert('éå»ãƒ‡ãƒ¼ã‚¿ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
        return;
      }
      const lines = text.split(/\r?\n/).map(l => l.trim()).filter(l => l);
      const newHistory = [];
      const newCounts = new Array(MAX_NUMBER + 1).fill(0);

      for (const line of lines) {
        const numsStr = line.match(/\d+/g);
        if (!numsStr || numsStr.length < 6) continue;
        const nums = numsStr.slice(0, 6).map(s => parseInt(s, 10));
        if (nums.some(n => n < 1 || n > MAX_NUMBER)) continue;
        newHistory.push(nums);
        for (const n of nums) newCounts[n] += 1;
      }

      if (!newHistory.length) {
        alert('æœ‰åŠ¹ãªè¡ŒãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚\næ•°å­—ãŒ6å€‹ä»¥ä¸Šã®è¡Œã ã‘ãŒå¯¾è±¡ã«ãªã‚Šã¾ã™ã€‚');
        return;
      }

      historyData = newHistory;
      counts = newCounts;
      updateChart();
      updateStatsLabel();
      alert(`${historyData.length}å›åˆ†ã®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸã€‚`);
    }

    function clearHistory() {
      if (!historyData.length && !historyInput.value.trim()) return;
      if (!confirm('éå»ãƒ‡ãƒ¼ã‚¿ã¨ã‚°ãƒ©ãƒ•ã‚’ã™ã¹ã¦ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ')) return;

      historyData = [];
      counts = new Array(MAX_NUMBER + 1).fill(0);
      historyInput.value = '';
      updateChart();
      updateStatsLabel();
      lastPredictions = [];
      lastChosenIndex = null;
      clearPredictResult();
      diceLabel.textContent = 'ã‚µã‚¤ã‚³ãƒ­çµæœï¼š-';
      lotteryLabel.textContent = 'æŠ½é¸ã‚²ãƒ¼ãƒ çµæœï¼š-';
      btnLottery.disabled = true;
      gameRunning = false;

      // ã‚¹ãƒ­ãƒƒãƒˆã‚‚åˆæœŸåŒ–
      slotCells.forEach(c => c.textContent = '--');
      if (slotBonusCell) slotBonusCell.textContent = '--';
      slotResultDiv.textContent = '';
    }

    // ===== ã‚»ãƒƒãƒˆè©•ä¾¡ï¼ˆâ€œAIã£ã½ã„ç‚¹æ•°â€ï¼‰ =====
    function evaluateSet(nums) {
      // 1) å‡ºç¾é »åº¦ã‚¹ã‚³ã‚¢
      let freqScore = 0;
      for (const n of nums) freqScore += counts[n];

      // 2) å¥‡æ•°/å¶æ•°ãƒãƒ©ãƒ³ã‚¹ï¼ˆ3:3ç†æƒ³ï¼‰
      const oddCount = nums.filter(n => n % 2 === 1).length;
      const diffFromIdeal = Math.abs(oddCount - 3);
      const oddScore = Math.max(0, 3 - diffFromIdeal);

      // 3) åˆè¨ˆå€¤ã‚¹ã‚³ã‚¢ï¼ˆ130å‰å¾Œã‚¿ãƒ¼ã‚²ãƒƒãƒˆï¼‰
      const total = nums.reduce((a, b) => a + b, 0);
      const target = 130;
      const sumPenalty = Math.abs(total - target);
      const sumScore = Math.max(0, 20 - (sumPenalty / 2));

      return freqScore * 2 + oddScore * 3 + sumScore;
    }

    // ===== äºˆæƒ³ãƒ­ã‚¸ãƒƒã‚¯ =====
    function predictRandom() {
      const base = [];
      for (let i = 1; i <= MAX_NUMBER; i++) base.push(i);
      return randomSample(base, 6);
    }

    function predictByFrequency() {
      const numbers = [];
      const weights = [];
      for (let i = 1; i <= MAX_NUMBER; i++) {
        numbers.push(i);
        weights.push(counts[i] + 1);
      }
      return weightedSample(numbers, weights, 6);
    }

    function predictByRecent() {
      if (!historyData.length) return predictRandom();
      const numbers = [];
      const weights = new Array(MAX_NUMBER + 1).fill(1.0);
      const nDraws = historyData.length;

      historyData.forEach((draw, idx) => {
        const recencyFactor = 0.3 + 0.7 * ((idx + 1) / nDraws);
        for (const num of draw) {
          if (1 <= num && num <= MAX_NUMBER) {
            weights[num] += recencyFactor;
          }
        }
      });

      for (let i = 1; i <= MAX_NUMBER; i++) numbers.push(i);
      const w = numbers.map(n => weights[n]);
      return weightedSample(numbers, w, 6);
    }

    function predictCold() {
      if (!historyData.length) return predictRandom();
      const numbers = [];
      let maxCount = 0;
      for (let i = 1; i <= MAX_NUMBER; i++) if (counts[i] > maxCount) maxCount = counts[i];

      const weights = [];
      for (let n = 1; n <= MAX_NUMBER; n++) {
        numbers.push(n);
        const weight = (maxCount - counts[n]) + 1;
        weights.push(Math.max(weight, 1));
      }
      return weightedSample(numbers, weights, 6);
    }

    function predictNumbers() {
      let mode = getSelectedRadio('mode', 'frequency');

      if (!historyData.length && mode !== 'random') {
        const ok = confirm('ã¾ã éå»ãƒ‡ãƒ¼ã‚¿ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚\nå®Œå…¨ãƒ©ãƒ³ãƒ€ãƒ ã§äºˆæƒ³ã—ã¾ã™ã‹ï¼Ÿ');
        if (!ok) return;
        mode = 'random';
      }

      let count = parseInt(predictCountInput.value, 10);
      if (Number.isNaN(count)) {
        alert('äºˆæƒ³ã‚»ãƒƒãƒˆæ•°ã¯1ã€œ20ã®æ•°å­—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
        return;
      }
      count = Math.max(1, Math.min(20, count));

      const predictions = [];
      const used = new Set();

      for (let loop = 0; loop < count * 3; loop++) {
        if (predictions.length >= count) break;

        let nums;
        if (mode === 'random') nums = predictRandom();
        else if (mode === 'frequency') nums = predictByFrequency();
        else if (mode === 'recent') nums = predictByRecent();
        else if (mode === 'cold') nums = predictCold();
        else nums = predictRandom();

        nums.sort((a, b) => a - b);
        const key = nums.join(',');
        if (used.has(key)) continue;
        used.add(key);
        const score = evaluateSet(nums);
        predictions.push({ nums, score });
      }

      predictions.sort((a, b) => b.score - a.score);
      lastPredictions = predictions;
      lastChosenIndex = null;
      gameRunning = false;
      btnLottery.disabled = true;
      diceLabel.textContent = 'ã‚µã‚¤ã‚³ãƒ­çµæœï¼š-';
      lotteryLabel.textContent = 'æŠ½é¸ã‚²ãƒ¼ãƒ çµæœï¼š-';

      clearPredictResult();
      if (!predictions.length) {
        predictResultDiv.textContent = 'äºˆæƒ³ã‚»ãƒƒãƒˆã‚’ç”Ÿæˆã§ãã¾ã›ã‚“ã§ã—ãŸã€‚';
      } else {
        let lines = '';
        predictions.forEach((p, idx) => {
          const rank = String(idx + 1).padStart(2, '0');
          const numsStr = p.nums.map(n => pad2(n)).join(' ');
          lines += `${rank}ä½ï¼š ${numsStr}   [è©•ä¾¡: ${p.score.toFixed(1)}]\n`;
        });
        predictResultDiv.textContent = lines;
      }
    }

    // ===== ã‚µã‚¤ã‚³ãƒ­ & æŠ½é¸ã‚²ãƒ¼ãƒ  =====
    function chooseWithDice() {
      if (!lastPredictions.length) {
        alert('ã¾ã äºˆæƒ³ãŒã‚ã‚Šã¾ã›ã‚“ã€‚\nå…ˆã«ã€Œäºˆæƒ³ã™ã‚‹ï¼ˆãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤ºï¼‰ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚');
        return;
      }
      const idx = Math.floor(Math.random() * lastPredictions.length);
      lastChosenIndex = idx;
      const chosen = lastPredictions[idx];
      const rank = idx + 1;
      const numsStr = chosen.nums.map(n => pad2(n)).join(' ');
      diceLabel.textContent = `ã‚µã‚¤ã‚³ãƒ­çµæœï¼šç¬¬${String(rank).padStart(2,'0')}ä½ã®ã‚»ãƒƒãƒˆ â†’ ${numsStr}`;
      lotteryLabel.textContent = 'æŠ½é¸ã‚²ãƒ¼ãƒ çµæœï¼š-';
      btnLottery.disabled = false;
      gameRunning = false;
    }

    function startLotteryGame() {
      if (!lastPredictions.length || lastChosenIndex === null) {
        alert('ã¾ãšã€Œã‚µã‚¤ã‚³ãƒ­ã§1å£é¸ã¶ã€ã§ã‚»ãƒƒãƒˆã‚’é¸ã‚“ã§ãã ã•ã„ã€‚');
        return;
      }
      if (gameRunning) return;
      gameRunning = true;
      btnLottery.disabled = true;
      lotterySteps = 0;
      if (lotteryTimer) clearInterval(lotteryTimer);
      lotteryTimer = setInterval(lotterySpin, 100);
    }

    function lotterySpin() {
      const texts = [
        'æŠ½é¸ä¸­â€¦ ãƒ‰ã‚­ãƒ‰ã‚­â€¦',
        'æŠ½é¸ä¸­â€¦ ã‚°ãƒ«ã‚°ãƒ«â€¦',
        'æŠ½é¸ä¸­â€¦ é‹ã‚’åˆ¤å®šä¸­â€¦',
        'æŠ½é¸ä¸­â€¦ ãã‚ãã‚æ­¢ã¾ã‚‹ï¼Ÿ'
      ];
      lotteryLabel.textContent = texts[Math.floor(Math.random() * texts.length)];
      lotterySteps++;
      if (lotterySteps >= 15) {
        clearInterval(lotteryTimer);
        lotteryTimer = null;
        const r = Math.random();
        let resultText;
        if (r < 0.5) {
          resultText = 'æŠ½é¸ã‚²ãƒ¼ãƒ çµæœï¼šå¤§å½“ãŸã‚Šï¼ã“ã®ã‚»ãƒƒãƒˆã§å‹è² ï¼';
        } else if (r < 0.8) {
          resultText = 'æŠ½é¸ã‚²ãƒ¼ãƒ çµæœï¼šã¾ã‚ã¾ã‚â€¦æ‚ªããªã„ã‹ã‚‚ï¼Ÿ';
        } else {
          resultText = 'æŠ½é¸ã‚²ãƒ¼ãƒ çµæœï¼šä»Šå›ã¯è¦‹é€ã‚Šâ€¦åˆ¥ã®ã‚»ãƒƒãƒˆã‚‚ã‚¢ãƒª';
        }
        lotteryLabel.textContent = resultText;
        gameRunning = false;
        btnLottery.disabled = false;
      }
    }

    // ===== AIæœ¬æ°—äºˆæƒ³ã‚³ã‚¢ï¼ˆã‚¹ãƒ­ãƒƒãƒˆï¼†æœ¬æ°—ãƒœã‚¿ãƒ³å…±ç”¨ï¼‰ =====
    function aiCoreBestSet() {
      const baseNumbers = [];
      for (let i = 1; i <= MAX_NUMBER; i++) baseNumbers.push(i);

      const freq = baseNumbers.map(n => counts[n] + 1);

      const recentBoost = new Array(MAX_NUMBER + 1).fill(1.0);
      if (historyData.length) {
        const nDraws = historyData.length;
        const recentPart = historyData.slice(-Math.min(60, nDraws));
        const len = recentPart.length;
        recentPart.forEach((draw, idx) => {
          const recencyFactor = 0.4 + 0.6 * ((idx + 1) / len);
          for (const num of draw) {
            recentBoost[num] += recencyFactor;
          }
        });
      }

      let maxCount = 0;
      for (let i = 1; i <= MAX_NUMBER; i++) if (counts[i] > maxCount) maxCount = counts[i];
      const cold = baseNumbers.map(n => (maxCount - counts[n] + 1));

      const combinedWeights = baseNumbers.map((n, idx) => {
        const w = freq[idx] * 1.5 + recentBoost[n] * 1.2 + cold[idx] * 0.8;
        return Math.max(w, 0.1);
      });

      let bestNums = null;
      let bestScore = -1e9;
      for (let loop = 0; loop < 500; loop++) {
        const chosen = weightedSample(baseNumbers, combinedWeights, 6).sort((a, b) => a - b);
        const score = evaluateSet(chosen);
        if (score > bestScore) {
          bestScore = score;
          bestNums = chosen;
        }
      }
      return bestNums;
    }

    // ===== AIã‚¨ãƒ³ã‚¿ãƒ¡ï¼šæ°—åˆ†è¨ºæ–­ =====
    function predictByMood() {
      if (!historyData.length) {
        console.log('éå»ãƒ‡ãƒ¼ã‚¿ãªã—ï¼šå®Œå…¨ãƒ©ãƒ³ãƒ€ãƒ å¯„ã‚Šã«ãªã‚Šã¾ã™');
      }
      const mood = getSelectedRadio('mood', 'normal');
      const baseNumbers = [];
      for (let i = 1; i <= MAX_NUMBER; i++) baseNumbers.push(i);

      let weights = [];
      if (mood === 'attack') {
        weights = baseNumbers.map(n => n <= 20 ? 1 : 3);
      } else if (mood === 'defense') {
        weights = baseNumbers.map(n => (10 <= n && n <= 30) ? 3 : 1);
      } else {
        weights = baseNumbers.map(n => counts[n] + 1);
      }

      const nums = weightedSample(baseNumbers, weights, 6).sort((a, b) => a - b);
      const total = nums.reduce((a, b) => a + b, 0);

      clearAiOutput();
      appendAiOutput('ã€æ°—åˆ†è¨ºæ–­AIäºˆæƒ³ã€‘');
      const moodText = mood === 'attack' ? 'æ”»ã‚ã‚‹' : mood === 'defense' ? 'å®ˆã‚‹' : 'æ™®é€š';
      appendAiOutput(`ä»Šæ—¥ã®æ°—åˆ†ï¼š${moodText}`);
      appendAiOutput('é¸ã°ã‚ŒãŸæ•°å­—ï¼š ' + nums.map(n => pad2(n)).join(' '));

      let msg;
      if (mood === 'attack') {
        msg = 'æ”»ã‚ã®æ°—åˆ†ã«åˆã‚ã›ã¦ã€é«˜ã‚ã®æ•°å­—ã‚’å¤šã‚ã«ãƒŸãƒƒã‚¯ã‚¹ã—ã¾ã—ãŸã€‚';
      } else if (mood === 'defense') {
        msg = 'å®ˆã‚Šæ°—å‘³ã®ãƒãƒ©ãƒ³ã‚¹ã§ã€ä¸­ç›¤ã®æ•°å­—ã‚’ä¸­å¿ƒã«çµ„ã‚“ã§ã„ã¾ã™ã€‚';
      } else {
        msg = 'ã»ã©ã‚ˆããƒãƒ©ãƒ³ã‚¹å‹ã€‚ç„¡ç†ã®ãªã„æ§‹æˆã«ãªã£ã¦ã„ã¾ã™ã€‚';
      }
      appendAiOutput(`ã‚³ãƒ¡ãƒ³ãƒˆï¼š${msg}ï¼ˆåˆè¨ˆå€¤ï¼š${total}ï¼‰`);
    }

    // ===== AIã‚¨ãƒ³ã‚¿ãƒ¡ï¼šã‚­ãƒ£ãƒ©åˆ¥ =====
    function characterWizard() {
      const baseNumbers = [];
      for (let i = 1; i <= MAX_NUMBER; i++) baseNumbers.push(i);
      const recentBoost = new Array(MAX_NUMBER + 1).fill(1.0);

      if (historyData.length) {
        const nDraws = historyData.length;
        const recentPart = historyData.slice(-Math.min(30, nDraws));
        const len = recentPart.length;
        recentPart.forEach((draw, idx) => {
          const recencyFactor = 0.5 + 0.5 * ((idx + 1) / len);
          for (const num of draw) {
            recentBoost[num] += recencyFactor;
          }
        });
      }

      let maxCount = 0;
      for (let i = 1; i <= MAX_NUMBER; i++) if (counts[i] > maxCount) maxCount = counts[i];

      const weights = baseNumbers.map(n => {
        const coldFactor = (maxCount - counts[n] + 1);
        let w = (counts[n] + 1) * recentBoost[n] + coldFactor * 0.3;
        return Math.max(w, 0.1);
      });

      return weightedSample(baseNumbers, weights, 6).sort((a, b) => a - b);
    }

    function characterDragon() {
      const baseNumbers = [];
      const weights = [];
      for (let n = 1; n <= MAX_NUMBER; n++) {
        baseNumbers.push(n);
        const highBonus = n >= 25 ? 2.5 : 1.0;
        const w = (counts[n] + 1) * highBonus;
        weights.push(w);
      }
      return weightedSample(baseNumbers, weights, 6).sort((a, b) => a - b);
    }

    function characterMath() {
      let bestNums = null;
      let bestScore = -1e9;
      for (let loop = 0; loop < 200; loop++) {
        const nums = predictByFrequency();
        const score = evaluateSet(nums);
        if (score > bestScore) {
          bestScore = score;
          bestNums = nums;
        }
      }
      return bestNums.sort((a, b) => a - b);
    }

    function characterGambler() {
      const baseNumbers = [];
      for (let i = 1; i <= MAX_NUMBER; i++) baseNumbers.push(i);
      let weights;
      if (Math.random() < 0.5) {
        weights = baseNumbers.map(n => n <= 25 ? 5 : 1);
      } else {
        weights = baseNumbers.map(n => n <= 25 ? 1 : 5);
      }
      return weightedSample(baseNumbers, weights, 6).sort((a, b) => a - b);
    }

    function predictByCharacter(type) {
      if (!historyData.length) {
        console.log('éå»ãƒ‡ãƒ¼ã‚¿ãªã—ï¼šã‚­ãƒ£ãƒ©ã®ç™–ã¯å¼±ã‚ã«ãªã‚Šã¾ã™');
      }
      let nums, name, comment;
      if (type === 'wizard') {
        nums = characterWizard();
        name = 'ğŸ§™â€â™‚ï¸ é­”æ³•ä½¿ã„AI';
        comment = 'æ•°å­—ã®â€œæ³¢â€ã¨ãƒãƒ©ãƒ³ã‚¹ã‚’é‡è¦–ã—ã¦ã€é™ã‹ã«å…‰ã£ã¦ã„ã‚‹æ•°å­—ã‚’æ‹¾ã„ã¾ã—ãŸã€‚';
      } else if (type === 'dragon') {
        nums = characterDragon();
        name = 'ğŸ‰ ãƒ‰ãƒ©ã‚´ãƒ³AI';
        comment = 'ãƒ‰ãƒ©ã‚´ãƒ³ã‚‰ã—ãã€å¤§ãã‚ã®æ•°å­—ã‚’ä¸­å¿ƒã«è’ã€…ã—ãã¾ã¨ã‚ã¦ã„ã¾ã™ã€‚';
      } else if (type === 'math') {
        nums = characterMath();
        name = 'ğŸ§  æ•°å­¦åšå£«AI';
        comment = 'å‡ºç¾é »åº¦ãƒ»å¥‡æ•°å¶æ•°ãƒ»åˆè¨ˆå€¤ã‚’ãã‚Œã£ã½ãæœ€é©åŒ–ã—ãŸâ€œç†å±ˆã£ã½ã„â€ã‚»ãƒƒãƒˆã§ã™ã€‚';
      } else {
        nums = characterGambler();
        name = 'ğŸ¤¡ ã‚®ãƒ£ãƒ³ãƒ–ãƒ©ãƒ¼AI';
        comment = 'ã‚ãˆã¦åã‚‰ã›ã¦ã„ã¾ã™ã€‚ãƒãƒã‚Œã°ãƒ‡ã‚«ã„ã€ä¸€ç™ºç‹™ã„ã®æ§‹æˆã€‚';
      }

      clearAiOutput();
      appendAiOutput(`ã€ã‚­ãƒ£ãƒ©åˆ¥AIäºˆæƒ³ã€‘${name}`);
      appendAiOutput('é¸ã°ã‚ŒãŸæ•°å­—ï¼š ' + nums.map(n => pad2(n)).join(' '));
      appendAiOutput('ã‚³ãƒ¡ãƒ³ãƒˆï¼š' + comment);
    }

    // ===== AIã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ¢ãƒ¼ãƒ‰ =====
    function aiStoryMode() {
      let base;
      if (lastPredictions.length) {
        base = lastPredictions[0].nums;
      } else {
        base = aiCoreBestSet();
      }
      const nums = base.slice().sort((a, b) => a - b);
      const total = nums.reduce((a, b) => a + b, 0);
      let oddCount = nums.filter(n => n % 2 === 1).length;
      let keyNum;
      if (historyData.length) {
        keyNum = nums.reduce((best, n) => (counts[n] > counts[best] ? n : best), nums[0]);
      } else {
        keyNum = nums[Math.floor(Math.random() * nums.length)];
      }

      clearAiOutput();
      appendAiOutput('ã€ğŸ“– AIã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ¢ãƒ¼ãƒ‰ã€‘');
      appendAiOutput('ä»Šå›ã€AIãŒâ€œæ³¢â€ã‚’æ„Ÿã˜å–ã£ãŸã‚»ãƒƒãƒˆã¯ã“ã‚Œã§ã™ï¼š');
      appendAiOutput('â†’  ' + nums.map(n => pad2(n)).join(' '));
      appendAiOutput('');
      appendAiOutput('ï¼œAIã®å‹æ‰‹ãªç‰©èªï¼');
      appendAiOutput(`éå»ã®æµã‚Œã‚’è¿½ã†ã¨ã€ã€Œ${pad2(keyNum)}ã€ã¯é™ã‹ã«ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’æºœã‚ã¦ã„ã‚‹æ•°å­—ã§ã™ã€‚`);
      appendAiOutput(`å¥‡æ•° ${oddCount} å€‹ã¨ã„ã†ãƒãƒ©ãƒ³ã‚¹ã¯ã€â€œåã‚Šã™ããšæ”»ã‚ã™ããªã„â€ã¡ã‚‡ã†ã©ä¸­åº¸ã®å½¢ã€‚`);
      appendAiOutput(`åˆè¨ˆå€¤ã¯ ${total}ã€‚ã“ã‚Œã¯ã€AIãŒå¥½ã‚€ã‚¾ãƒ¼ãƒ³ï¼ˆãŠã‚ˆã120ã€œ150ï¼‰ã®ä¸­ã«åã¾ã£ã¦ã„ã¾ã™ã€‚`);
      appendAiOutput('');
      appendAiOutput(
        'ã‚‚ã¡ã‚ã‚“æœ€çµ‚çš„ã«ã¯â€œé‹â€ã§ã™ãŒã€ä»Šå›ã®ã‚»ãƒƒãƒˆã¯\n' +
        'ã€Œæµã‚Œã«é€†ã‚‰ã‚ãšã€ã§ã‚‚å°‘ã—ã ã‘å¤¢ã‚’è¦‹ã‚‰ã‚Œã‚‹æ§‹æˆã€ã«ãªã£ã¦ã„ã¾ã™ã€‚'
      );
    }

    // ===== AIæœ¬æ°—äºˆæƒ³ =====
    function aiStrongPrediction() {
      const nums = aiCoreBestSet();
      const score = evaluateSet(nums);

      clearAiOutput();
      appendAiOutput('ã€ğŸ’¥ AIæœ¬æ°—äºˆæƒ³ã€‘');
      appendAiOutput('AIãŒâ€œæœ¬æ°—ã§â€1ã‚»ãƒƒãƒˆã ã‘é¸ã¶ã¨ã“ã†ãªã‚Šã¾ã™ï¼š');
      appendAiOutput('â†’  ' + nums.map(n => pad2(n)).join(' '));
      appendAiOutput('');
      appendAiOutput(`å†…éƒ¨ã‚¹ã‚³ã‚¢ï¼š${score.toFixed(1)}`);
      appendAiOutput(
        'ãƒ»éå»ã®å‡ºç¾é »åº¦\n' +
        'ãƒ»æœ€è¿‘ã®å‚¾å‘\n' +
        'ãƒ»ã‚ã¾ã‚Šå‡ºã¦ã„ãªã„æ•°å­—\n' +
        'ãƒ»å¥‡æ•°/å¶æ•°ãƒãƒ©ãƒ³ã‚¹\n' +
        'ãƒ»åˆè¨ˆå€¤ã®ãƒ¬ãƒ³ã‚¸\n' +
        'ã‚ãŸã‚Šã‚’å…¨éƒ¨ãƒŸãƒƒã‚¯ã‚¹ã—ã¦ã€ãã‚Œã£ã½ãâ€œæœ€é©åŒ–â€ã—ã¦ã„ã¾ã™ã€‚'
      );
    }

    // ===== ã‚¹ãƒ­ãƒƒãƒˆæ¼”å‡ºï¼ˆå£æ•°é¸æŠã¤ãï¼‰ =====
    function generateRandomBonus(mainNums) {
      while (true) {
        const b = Math.floor(Math.random() * MAX_NUMBER) + 1;
        if (!mainNums.includes(b)) return b;
      }
    }

    function slotAnimationStart() {
      let count = parseInt(slotCountInput.value, 10);
      if (Number.isNaN(count)) count = 1;
      count = Math.max(1, Math.min(20, count));

      slotResultSets = [];
      const used = new Set();

      for (let i = 0; i < count; i++) {
        let nums;
        if (historyData.length) {
          nums = aiCoreBestSet();
        } else {
          nums = predictRandom();
        }
        nums = Array.from(new Set(nums)).sort((a, b) => a - b);

        const key = nums.join(',');
        if (used.has(key)) {
          i--;
          continue;
        }
        used.add(key);

        const bonus = generateRandomBonus(nums);
        slotResultSets.push({ main: nums, bonus });

        if (i === 0) {
          slotTargetMain = nums;
          slotTargetBonus = bonus;
        }
      }

      slotStep = 0;
      if (slotTimer) {
        clearTimeout(slotTimer);
        slotTimer = null;
      }
      spinSlotStep();
    }

    function spinSlotStep() {
      const maxBase = 20;
      const delay = 80;
      let done = true;

      // æœ¬æ•°å­—6å€‹
      for (let i = 0; i < 6; i++) {
        const cell = slotCells[i];
        if (!cell) continue;
        if (slotStep < maxBase + i * 5) {
          const val = Math.floor(Math.random() * MAX_NUMBER) + 1;
          cell.textContent = pad2(val);
          done = false;
        } else if (slotTargetMain && slotTargetMain[i] != null) {
          cell.textContent = pad2(slotTargetMain[i]);
        }
      }

      // ãƒœãƒ¼ãƒŠã‚¹
      if (slotBonusCell) {
        if (slotStep < maxBase + 6 * 5) {
          const val = Math.floor(Math.random() * MAX_NUMBER) + 1;
          slotBonusCell.textContent = pad2(val);
          done = false;
        } else if (slotTargetBonus != null) {
          slotBonusCell.textContent = pad2(slotTargetBonus);
        }
      }

      slotStep++;
      if (!done) {
        slotTimer = setTimeout(spinSlotStep, delay);
      } else {
        // çµæœä¸€è¦§ã‚’è¡¨ç¤º
        let text = `ã‚¹ãƒ­ãƒƒãƒˆçµæœï¼ˆ${slotResultSets.length}å£ï¼‰ï¼š\n`;
        slotResultSets.forEach((s, idx) => {
          const line =
            `${idx + 1}å£ç›®ï¼š ` +
            s.main.map(n => pad2(n)).join(' ') +
            `  [B:${pad2(s.bonus)}]`;
          text += line + '\n';
        });
        slotResultDiv.textContent = text;
      }
    }

    // ===== ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š =====
    btnLoad.addEventListener('click', loadHistory);
    btnClear.addEventListener('click', clearHistory);
    btnPredict.addEventListener('click', predictNumbers);
    btnDice.addEventListener('click', chooseWithDice);
    btnLottery.addEventListener('click', startLotteryGame);

    btnMood.addEventListener('click', predictByMood);
    btnCharWizard.addEventListener('click', () => predictByCharacter('wizard'));
    btnCharDragon.addEventListener('click', () => predictByCharacter('dragon'));
    btnCharMath.addEventListener('click', () => predictByCharacter('math'));
    btnCharGambler.addEventListener('click', () => predictByCharacter('gambler'));
    btnStory.addEventListener('click', aiStoryMode);
    btnStrong.addEventListener('click', aiStrongPrediction);

    btnSlot.addEventListener('click', slotAnimationStart);

    // åˆæœŸåŒ–
    window.addEventListener('load', () => {
      initChart();
      updateStatsLabel();
    });
  </script>
</body>
</html>
